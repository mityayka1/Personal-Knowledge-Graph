# –§–∞–∑–∞ A: Act Capabilities

**–¶–µ–ª—å:** –°–∏—Å—Ç–µ–º–∞ –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –¥–µ–π—Å—Ç–≤–∏—è (–æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π) —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**–ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** 1-2 –Ω–µ–¥–µ–ª–∏

**–ë–∏–∑–Ω–µ—Å-—Ü–µ–Ω–Ω–æ—Å—Ç—å:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –ø–æ–ø—Ä–æ—Å–∏—Ç—å "–Ω–∞–ø–∏—à–∏ –°–µ—Ä–≥–µ—é —á—Ç–æ –≤—Å—Ç—Ä–µ—á–∞ –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—Å—è" –∏ —Å–∏—Å—Ç–µ–º–∞ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ.

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### Bot + Userbot —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    TELEGRAM ADAPTER                          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                              ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê       ‚îÇ
‚îÇ  ‚îÇ      BOT        ‚îÇ              ‚îÇ    USERBOT      ‚îÇ       ‚îÇ
‚îÇ  ‚îÇ  (@pkg_bot)     ‚îÇ              ‚îÇ    (GramJS)     ‚îÇ       ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§              ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§       ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è   ‚îÇ              ‚îÇ ‚Ä¢ –ß—Ç–µ–Ω–∏–µ —á–∞—Ç–æ–≤  ‚îÇ       ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ –ö–Ω–æ–ø–∫–∏ UI     ‚îÇ              ‚îÇ ‚Ä¢ –û—Ç–ø—Ä–∞–≤–∫–∞      ‚îÇ       ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ Approval flow ‚îÇ              ‚îÇ   —Å–æ–æ–±—â–µ–Ω–∏–π     ‚îÇ       ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ Morning brief ‚îÇ              ‚îÇ   –û–¢ –ò–ú–ï–ù–ò      ‚îÇ       ‚îÇ
‚îÇ  ‚îÇ                 ‚îÇ              ‚îÇ   –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø  ‚îÇ       ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ≤‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò       ‚îÇ
‚îÇ           ‚îÇ                                ‚îÇ                 ‚îÇ
‚îÇ           ‚îÇ    [‚úÖ –û—Ç–ø—Ä–∞–≤–∏—Ç—å]              ‚îÇ                 ‚îÇ
‚îÇ           ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                 ‚îÇ
‚îÇ                                                              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## –ó–∞–¥–∞—á–∏

### A1.1: ActionToolsProvider

```typescript
@Injectable()
export class ActionToolsProvider {
  private cachedTools: ToolDefinition[] | null = null;

  getTools(): ToolDefinition[] {
    if (!this.cachedTools) {
      this.cachedTools = this.createTools();
    }
    return this.cachedTools;
  }

  private createTools() {
    return [
      tool(
        'draft_message',
        `Create a draft message for a contact WITHOUT sending it.
Use this to show the user what message will be sent before getting approval.`,
        {
          entityId: z.string().uuid().describe('ID of the recipient'),
          intent: z.string().describe('What the message should communicate'),
          tone: z.enum(['formal', 'casual', 'friendly']).default('friendly'),
        },
        async (args) => {
          const entity = await this.entityService.findOne(args.entityId);
          if (!entity) return toolError(`Entity not found`);

          const draft = await this.generateDraft(entity.name, args.intent, args.tone);
          return toolSuccess({ draft, recipient: entity.name });
        }
      ),

      tool(
        'send_telegram',
        `Send a Telegram message. ‚ö†Ô∏è REQUIRES USER APPROVAL.
Always use draft_message first.`,
        {
          entityId: z.string().uuid().describe('ID of the recipient'),
          text: z.string().min(1).max(4096).describe('Message text'),
        },
        async (args) => {
          await this.telegramService.sendToEntity(args.entityId, args.text);
          return toolSuccess({ sent: true });
        }
      ),

      tool(
        'schedule_followup',
        `Schedule a follow-up reminder for a contact.`,
        {
          entityId: z.string().uuid().describe('ID of the contact'),
          reason: z.string().describe('What to follow up about'),
          checkAfter: z.string().describe('When to check (ISO or relative)'),
        },
        async (args) => {
          const event = await this.entityEventService.create({
            entityId: args.entityId,
            eventType: EventType.FOLLOW_UP,
            title: `Follow up: ${args.reason}`,
            eventDate: parseDate(args.checkAfter),
          });
          return toolSuccess({ created: true, id: event.id });
        }
      ),
    ];
  }
}
```

---

### A1.2: Approval Hook

```typescript
@Injectable()
export class ApprovalHookService {
  private readonly pendingApprovals = new Map<string, {
    resolve: (result: ApprovalResult) => void;
    timeout: NodeJS.Timeout;
  }>();

  createHook(): AgentHooks {
    return {
      onToolUse: async (toolName: string, input: unknown) => {
        if (toolName === 'send_telegram') {
          return this.requestApproval(toolName, input);
        }
        return { approve: true };
      },
    };
  }

  async requestApproval(action: string, input: { entityId: string; text: string }) {
    const entity = await this.entityService.findOne(input.entityId);
    const eventId = randomUUID();

    const message = `üì§ **–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ?**

**–ö–æ–º—É:** ${entity?.name}

**–¢–µ–∫—Å—Ç:**
${input.text}`;

    const buttons = [
      [
        { text: '‚úÖ –û—Ç–ø—Ä–∞–≤–∏—Ç—å', callback_data: `approve:${eventId}` },
        { text: '‚ùå –û—Ç–º–µ–Ω–∞', callback_data: `reject:${eventId}` },
      ],
      [
        { text: '‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å', callback_data: `edit:${eventId}` },
      ],
    ];

    await this.telegramNotifier.sendWithButtons(message, buttons);

    return new Promise((resolve) => {
      const timeout = setTimeout(() => {
        this.pendingApprovals.delete(eventId);
        resolve({ approve: false, reason: 'Timeout' });
      }, 120000);

      this.pendingApprovals.set(eventId, { resolve, timeout });
    });
  }
}
```

---

### A1.4: Act API Endpoint

```typescript
@Post('act')
async act(@Body() dto: ActRequestDto): Promise<ActResponseDto> {
  const approvalHook = this.approvalHookService.createHook();

  const { data, usage, toolsUsed } = await this.agentService.call<ActResult>({
    mode: 'agent',
    taskType: 'action',
    prompt: this.buildActPrompt(dto.instruction),
    toolCategories: ['entities', 'events', 'actions'],
    hooks: approvalHook,
    maxTurns: 10,
  });

  return { result: data, actions: this.extractActions(toolsUsed), usage };
}

private buildActPrompt(instruction: string): string {
  return `–í—ã–ø–æ–ª–Ω–∏ –¥–µ–π—Å—Ç–≤–∏–µ: "${instruction}"

–ü–æ—Ä—è–¥–æ–∫:
1. –ù–∞–π–¥–∏ –∫–æ–Ω—Ç–∞–∫—Ç–∞ (list_entities)
2. –°–æ–∑–¥–∞–π —á–µ—Ä–Ω–æ–≤–∏–∫ (draft_message)
3. –î–æ–∂–¥–∏—Å—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∏ –æ—Ç–ø—Ä–∞–≤—å (send_telegram)
4. –°–æ–∑–¥–∞–π follow-up –µ—Å–ª–∏ –Ω—É–∂–Ω–æ (schedule_followup)

–í–ê–ñ–ù–û: –í—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —á—Ç–æ –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –ü–ï–†–ï–î –æ—Ç–ø—Ä–∞–≤–∫–æ–π.`;
}
```

---

## UX –£–ª—É—á—à–µ–Ω–∏—è

### Approval Flow

```
üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ?

–ö–æ–º—É: –ú–∞—Ä–∏—è –ò–≤–∞–Ω–æ–≤–∞

–¢–µ–∫—Å—Ç:
–ü—Ä–∏–≤–µ—Ç, –ú–∞—à–∞! –ù–∞–ø–æ–º–∏–Ω–∞—é –ø—Ä–æ –¥–æ–∫—É–º–µ–Ω—Ç—ã.

[‚úÖ –û—Ç–ø—Ä–∞–≤–∏—Ç—å] [‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å] [‚ùå –û—Ç–º–µ–Ω–∞]
```

### –î–≤—É—Ö—Ä–µ–∂–∏–º–Ω–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ "–ò–∑–º–µ–Ω–∏—Ç—å":

```
–ö–∞–∫ —Ö–æ—á–µ—à—å –∏–∑–º–µ–Ω–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ?

[üí° –ó–∞–¥–∞—Ç—å] ‚Äî –æ–ø–∏—à–∏ —á—Ç–æ –Ω–∞–ø–∏—Å–∞—Ç—å, AI —Å—Ñ–æ—Ä–º—É–ª–∏—Ä—É–µ—Ç
[üìù –ö–∞–∫ –µ—Å—Ç—å] ‚Äî –Ω–∞–ø–∏—à–∏ —Ç–æ—á–Ω—ã–π —Ç–µ–∫—Å—Ç
```

### Proactive Action Buttons

Morning Brief —Å –∫–Ω–æ–ø–∫–∞–º–∏ –¥–µ–π—Å—Ç–≤–∏–π:

```
üåÖ –î–æ–±—Ä–æ–µ —É—Ç—Ä–æ! –í–æ—Ç —Ç–≤–æ–π –¥–µ–Ω—å:

üìÖ –í—Å—Ç—Ä–µ—á–∏:
‚Ä¢ 15:00 ‚Äî –°–æ–∑–≤–æ–Ω —Å –ü–µ—Ç—Ä–æ–º
  [üìã –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å brief]

üìã –ó–∞–¥–∞—á–∏:
‚Ä¢ –°–ø—Ä–æ—Å–∏—Ç—å —É –ú–∞—à–∏ –ø—Ä–æ –¥–æ–∫—É–º–µ–Ω—Ç—ã
  [üí¨ –ù–∞–ø–∏—Å–∞—Ç—å –ú–∞—à–µ]

üëÄ –ñ–¥—ë—à—å –æ—Ç–≤–µ—Ç–∞:
‚Ä¢ –°–µ—Ä–≥–µ–π ‚Äî –≤—Å—Ç—Ä–µ—á–∞ (–∂–¥—ë—à—å 3 –¥–Ω—è)
  [üí¨ –ù–∞–ø–æ–º–Ω–∏—Ç—å –°–µ—Ä–≥–µ—é]
```

### Follow-up –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏

```
‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –ú–∞—à–µ

üí° –°–æ–∑–¥–∞—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–≤–µ—Ç?

[‚è∞ –ß–µ—Ä–µ–∑ 2 —á–∞—Å–∞] [üìÖ –ó–∞–≤—Ç—Ä–∞] [üö´ –ù–µ –Ω—É–∂–Ω–æ]
```

---

## Deliverables

1. **Tools:**
   - ActionToolsProvider (draft_message, send_telegram, schedule_followup)

2. **Hooks:**
   - ApprovalHookService ‚Äî –∑–∞–ø—Ä–æ—Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —á–µ—Ä–µ–∑ Telegram

3. **Services:**
   - TelegramSendService ‚Äî –æ—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ —é–∑–µ—Ä–±–æ—Ç

4. **API:**
   - POST /agent/act
   - POST /telegram/send-as-user

5. **Telegram Bot:**
   - /act –∫–æ–º–∞–Ω–¥–∞
   - Approval callbacks
   - Edit mode selection
   - Proactive action buttons
   - Follow-up suggestion
