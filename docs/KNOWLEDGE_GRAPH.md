# PKG Knowledge Graph โ ะะพะฝัะตะฟััะฐะปัะฝะฐั ะผะพะดะตะปั

> ะะพะปะฝะฐั ะดะพะบัะผะตะฝัะฐัะธั ัััะฝะพััะตะน, ัะพััะฐะฒะปัััะธั ะณัะฐั ะทะฝะฐะฝะธะน Personal Knowledge Graph

## ะะณะปะฐะฒะปะตะฝะธะต

- [ะะฑะทะพั ะฐััะธัะตะบัััั](#ะพะฑะทะพั-ะฐััะธัะตะบัััั)
- [**ะกัะฐััั ัะตะฐะปะธะทะฐัะธะธ**](#ััะฐััั-ัะตะฐะปะธะทะฐัะธะธ) โ ะผะฐััะธัะฐ ะณะพัะพะฒะฝะพััะธ entity
- [ะฃะทะปั ะณัะฐัะฐ (Nodes)](#ัะทะปั-ะณัะฐัะฐ-nodes)
  - [Entity](#entity) ๐ข
  - [Activity](#activity) ๐ก
- [ะััะธะฑััั ัะทะปะพะฒ (Node Properties)](#ะฐััะธะฑััั-ัะทะปะพะฒ-node-properties)
  - [EntityFact](#entityfact) ๐ข
  - [EntityIdentifier](#entityidentifier) ๐ข
- [ะัะฑัะฐ ะณัะฐัะฐ (Edges)](#ััะฑัะฐ-ะณัะฐัะฐ-edges)
  - [EntityRelation](#entityrelation) ๐ก
  - [Commitment](#commitment) ๐ก
  - [ActivityMember](#activitymember) ๐ด
- [ะะณัะตะณะธัะพะฒะฐะฝะฝัะต ะทะฝะฐะฝะธั (Summaries)](#ะฐะณัะตะณะธัะพะฒะฐะฝะฝัะต-ะทะฝะฐะฝะธั-summaries)
  - [EntityRelationshipProfile](#entityrelationshipprofile) ๐ข
  - [InteractionSummary](#interactionsummary) ๐ข
- [ะััะพัะฝะธะบะธ ะดะฐะฝะฝัั (Raw Data)](#ะธััะพัะฝะธะบะธ-ะดะฐะฝะฝัั-raw-data)
  - [Interaction](#interaction) ๐ข
  - [Message](#message) ๐ข
  - [TranscriptSegment](#transcriptsegment) ๐ข
- [ะะปะฐะฝะธััะตะผัะต ัััะฝะพััะธ (Phase E)](#ะฟะปะฐะฝะธััะตะผัะต-ัััะฝะพััะธ-phase-e)
  - [TopicalSegment](#topicalsegment) โช
  - [KnowledgePack](#knowledgepack) โช
- [**ะกะธััะตะผะฝัะต ะฟัะพะฑะปะตะผั ะธ ะฟะปะฐะฝ ััััะฐะฝะตะฝะธั**](#ัะธััะตะผะฝัะต-ะฟัะพะฑะปะตะผั-ะธ-ะฟะปะฐะฝ-ััััะฐะฝะตะฝะธั)
- [ะะธะทัะฐะปัะฝัะต ััะตะผั](#ะฒะธะทัะฐะปัะฝัะต-ััะตะผั)
- [ะกะฒะพะดะฝะฐั ัะฐะฑะปะธัะฐ](#ัะฒะพะดะฝะฐั-ัะฐะฑะปะธัะฐ)

---

## ะะฑะทะพั ะฐััะธัะตะบัััั

PKG Knowledge Graph โ ััะพ ะณัะฐั ะทะฝะฐะฝะธะน, ะณะดะต:

- **ะฃะทะปั (Nodes)** โ ััะฑัะตะบัั (ะปัะดะธ, ะพัะณะฐะฝะธะทะฐัะธะธ) ะธ ะบะพะฝัะตะบััั ะดะตััะตะปัะฝะพััะธ (ะฟัะพะตะบัั, ะทะฐะดะฐัะธ)
- **ะัะฑัะฐ (Edges)** โ ัะฒัะทะธ ะผะตะถะดั ััะฑัะตะบัะฐะผะธ (ัะตะผัั, ัะฐะฑะพัะฐ, ะพะฑัะทะฐัะตะปัััะฒะฐ)
- **ะััะธะฑััั** โ ัะฒะพะนััะฒะฐ ัะทะปะพะฒ (ัะฐะบัั, ะธะดะตะฝัะธัะธะบะฐัะพัั)
- **ะะณัะตะณะฐัะธะธ** โ ะบะพะฝัะพะปะธะดะธัะพะฒะฐะฝะฝัะต ะทะฝะฐะฝะธั (ะฟัะพัะธะปะธ, ัะฐะผะผะฐัะธ)
- **ะััะพัะฝะธะบะธ** โ ััััะต ะดะฐะฝะฝัะต (ัะพะพะฑัะตะฝะธั, ััะฐะฝัะบัะธะฟัะธะธ)

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                          KNOWLEDGE PYRAMID                                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                             โ
โ  Level 5:  KnowledgePack           โ ะะพะฝัะพะปะธะดะธัะพะฒะฐะฝะฝัะต ะทะฝะฐะฝะธั (Phase E)    โ
โ                                                                             โ
โ  Level 4:  EntityRelationshipProfile  โ ะัะพัะธะปั ะฒะทะฐะธะผะพะพัะฝะพัะตะฝะธะน            โ
โ            InteractionSummary         โ ะกะฐะผะผะฐัะธ ัะตััะธะน                     โ
โ                                                                             โ
โ  Level 3:  EntityFact              โ ะกัััะบัััะธัะพะฒะฐะฝะฝัะต ัะฐะบัั               โ
โ            Activity                โ ะัะพะตะบัั, ะทะฐะดะฐัะธ, ะพะฑะปะฐััะธ              โ
โ            Commitment              โ ะะฑะตัะฐะฝะธั ะธ ะดะพะณะพะฒะพััะฝะฝะพััะธ             โ
โ            EntityRelation          โ ะกะฒัะทะธ ะผะตะถะดั ะปัะดัะผะธ                    โ
โ                                                                             โ
โ  Level 2:  TopicalSegment          โ ะกะตะผะฐะฝัะธัะตัะบะธะต ัะตะณะผะตะฝัั (Phase E)      โ
โ                                                                             โ
โ  Level 1:  Message                 โ ะกัััะต ัะพะพะฑัะตะฝะธั                       โ
โ            TranscriptSegment       โ ะขัะฐะฝัะบัะธะฟัะธะธ ะทะฒะพะฝะบะพะฒ                  โ
โ            (ะฒ Interaction)                                                  โ
โ                                                                             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ะกัะฐััั ัะตะฐะปะธะทะฐัะธะธ

> **ะะฑะฝะพะฒะปะตะฝะพ:** 2025-02-05 ะฟะพัะปะต ะฐัะดะธัะฐ ะบะพะดะพะฒะพะน ะฑะฐะทั. ะะฐะถะดะฐั entity ะพัะตะฝะตะฝะฐ ะฟะพ ัััะผ ะฟะฐัะฐะผะตััะฐะผ: ะพะฟัะตะดะตะปะตะฝะฐ ะปะธ ะฒ ะบะพะดะต, ะฟะพะดะบะปััะตะฝะฐ ะปะธ ะบ extraction pipeline, ะธ ัะตะฐะปัะฝะพ ะปะธ ัะพะทะดะฐัััั ะทะฐะฟะธัะธ ะฒ production.

### ะฃัะปะพะฒะฝัะต ะพะฑะพะทะฝะฐัะตะฝะธั

| ะกัะฐััั | ะะฝะฐัะตะฝะธะต |
|--------|----------|
| ๐ข **PRODUCTION** | Entity ะฟะพะปะฝะพัััั ัะฐะฑะพัะฐะตั: ะบะพะด + extraction + ะทะฐะฟะธัะธ ะฒ ะะ |
| ๐ก **PARTIAL** | Entity ัะฐะฑะพัะฐะตั, ะฝะพ ัะฐััั ะฟะพะปะตะน/ัะฒัะทะตะน ะฝะต ะธัะฟะพะปัะทัะตััั |
| ๐ด **DORMANT** | Entity ะพะฟัะตะดะตะปะตะฝะฐ ะฒ ะบะพะดะต, ะฝะพ ะฝะธ ะพะดะธะฝ ัะตัะฒะธั ะฝะต ัะพะทะดะฐัั ะทะฐะฟะธัะธ |
| โช **PLANNED** | Entity ะพะฟะธัะฐะฝะฐ ัะพะปัะบะพ ะฒ ะดะพะบัะผะตะฝัะฐัะธะธ, ะบะพะด ะฝะต ะฝะฐะฟะธัะฐะฝ |

### ะะฐััะธัะฐ ะณะพัะพะฒะฝะพััะธ

| Entity | Entity ัะฐะนะป | ะะธะณัะฐัะธั | Extraction | ะะฐะฟะธัะธ ะฒ ะะ | ะกัะฐััั |
|--------|:-----------:|:--------:|:----------:|:------------:|:------:|
| Entity | โ | โ | โ | โ | ๐ข PRODUCTION |
| Activity | โ | โ | โ | โ | ๐ก PARTIAL โ ัะพะปัะบะพ PROJECT/TASK; 9 ะฟะพะปะตะน ะฒัะตะณะดะฐ NULL |
| EntityFact | โ | โ | โ | โ | ๐ข PRODUCTION |
| EntityIdentifier | โ | โ | โ | โ | ๐ข PRODUCTION |
| EntityRelation | โ | โ | โ | โ๏ธ manual only | ๐ก PARTIAL โ extraction ะฝะต ะฟะตััะธััะธั InferredRelations |
| EntityRelationMember | โ | โ | โ | โ๏ธ manual only | ๐ก PARTIAL โ ะทะฐะฒะธัะธั ะพั EntityRelation |
| Commitment | โ | โ | โ | โ | ๐ก PARTIAL โ `activityId` ะฝะธะบะพะณะดะฐ ะฝะต ะทะฐะฟะพะปะฝัะตััั |
| ActivityMember | โ | โ | โ | โ | ๐ด DORMANT โ ะฝะธ ะพะดะธะฝ ัะตัะฒะธั ะฝะต ัะพะทะดะฐัั ะทะฐะฟะธัะธ |
| EntityRelationshipProfile | โ | โ | โ | โ | ๐ข PRODUCTION |
| InteractionSummary | โ | โ | โ | โ | ๐ข PRODUCTION |
| Interaction | โ | โ | โ | โ | ๐ข PRODUCTION |
| Message | โ | โ | โ | โ | ๐ข PRODUCTION |
| TranscriptSegment | โ | โ | โ | โ | ๐ข PRODUCTION |
| InteractionParticipant | โ | โ | โ | โ | ๐ข PRODUCTION |
| TopicalSegment | โ | โ | โ | โ | โช PLANNED (Phase E) |
| KnowledgePack | โ | โ | โ | โ | โช PLANNED (Phase E) |

### ะะตัะฐะปะธ ัะฐััะธัะฝัั ัะตะฐะปะธะทะฐัะธะน

**Activity (๐ก PARTIAL):**
- ะะท 10 ActivityTypes ัะตะฐะปัะฝะพ ัะพะทะดะฐัััั ัะพะปัะบะพ `PROJECT` ะธ `TASK`
- ะะพะปั `description`, `priority`, `context`, `deadline`, `startDate`, `endDate`, `tags`, `progress`, `lastActivityAt` ะฒัะตะณะดะฐ NULL ะฟัะธ extraction
- ะขัะธ ะฟะฐััะตัะฝะฐ ะดะตัะตะฒะฐ (closure-table + adjacency + materialized path) ะพะฟัะตะดะตะปะตะฝั, ะฝะพ closure-table ะธ materialized path ัะฐะบัะธัะตัะบะธ ะฝะต ะธัะฟะพะปัะทััััั
- ะฃัะฐััะฝะธะบะธ ััะฐะฝัััั ะบะฐะบ `metadata.participants: string[]` ะฒะผะตััะพ ActivityMember

**EntityRelation (๐ก PARTIAL):**
- ะะพะปะฝะฐั N-ary ัะตะฐะปะธะทะฐัะธั ั EntityRelationMember
- LLM ะธะทะฒะปะตะบะฐะตั InferredRelations ะฟัะธ daily synthesis, ะฝะพ `extraction-persistence.service.ts` ะฝะต ัะพะดะตัะถะธั ะบะพะดะฐ ะดะปั ะธั ัะพััะฐะฝะตะฝะธั โ ะดะฐะฝะฝัะต ัะตัััััั
- ะัะฟะพะปัะทัะตััั ัะพะปัะบะพ ะฟัะธ ัััะฝะพะผ ัะพะทะดะฐะฝะธะธ ัะฒัะทะตะน

**Commitment (๐ก PARTIAL):**
- ะะทะฒะปะตะบะฐะตััั ะธะท ะฟะตัะตะฟะธัะบะธ, ะทะฐะฟะธัะธ ัะพะทะดะฐัััั
- ะะพะปะต `activityId` (FK โ Activity) ะพะฟัะตะดะตะปะตะฝะพ, ะฝะพ extraction ะฝะธะบะพะณะดะฐ ะฝะต ะฟัะธะฒัะทัะฒะฐะตั commitment ะบ ะฟัะพะตะบัั/ะทะฐะดะฐัะต

**ActivityMember (๐ด DORMANT):**
- Entity ัะฐะนะป ัะพะทะดะฐะฝ, ะผะธะณัะฐัะธั ะฒัะฟะพะปะฝะตะฝะฐ, 7 ัะพะปะตะน ะพะฟัะตะดะตะปะตะฝั
- `activity.service.ts` ะธะฝะถะตะบัะธััะตั ัะตะฟะพะทะธัะพัะธะน, ะฝะพ ะฝะต ะธัะฟะพะปัะทัะตั
- ะะผะตััะพ ActivityMember ััะฐััะฝะธะบะธ ััะฐะฝัััั ะบะฐะบ ัััะพะบะธ ะฒ `Activity.metadata.participants`

---

## ะฃะทะปั ะณัะฐัะฐ (Nodes)

### Entity

> ๐ข **PRODUCTION** โ ะฟะพะปะฝะพัััั ัะฐะฑะพัะฐะตั

**ะกัะฑัะตะบัั ะณัะฐัะฐ** โ ะปัะดะธ ะธ ะพัะณะฐะฝะธะทะฐัะธะธ, ัะตะฝััะฐะปัะฝัะต ัะทะปั ะฒัะตั ะทะฝะฐะฝะธะน.

| ะะพะปะต | ะขะธะฟ | ะะฟะธัะฐะฝะธะต |
|------|-----|----------|
| `id` | uuid | ะฃะฝะธะบะฐะปัะฝัะน ะธะดะตะฝัะธัะธะบะฐัะพั |
| `type` | enum | `PERSON` \| `ORGANIZATION` |
| `name` | string(255) | ะะผั/ะฝะฐะทะฒะฐะฝะธะต |
| `organizationId` | uuid? | FK โ Entity (ัะฐะฑะพัะฐะตั ะฒ ะพัะณะฐะฝะธะทะฐัะธะธ) |
| `notes` | text? | ะะฐะผะตัะบะธ |
| `profilePhoto` | text? | URL ัะพัะพ |
| `creationSource` | enum | `MANUAL` \| `PRIVATE_CHAT` \| `WORKING_GROUP` \| `EXTRACTED` |
| `isBot` | boolean | ะฏะฒะปัะตััั ะฑะพัะพะผ |
| `isOwner` | boolean | "ะฏ" (ะตะดะธะฝััะฒะตะฝะฝัะน, unique partial index) |
| `deletedAt` | timestamp? | Soft delete |

**ะคะฐะนะป:** `packages/entities/src/entity.entity.ts:31`

**ะกะฒัะทะธ:**
- `identifiers[]` โ EntityIdentifier (ะธะดะตะฝัะธัะธะบะฐัะพัั ะธะท ะธััะพัะฝะธะบะพะฒ)
- `facts[]` โ EntityFact (ะฐััะธะฑััั)
- `participations[]` โ InteractionParticipant (ััะฐััะธะต ะฒ ัะตััะธัั)
- `organization` โ Entity (ัะฐะฑะพัะพะดะฐัะตะปั)
- `employees[]` โ Entity[] (ัะพัััะดะฝะธะบะธ, ะตัะปะธ ััะพ ะพัะณะฐะฝะธะทะฐัะธั)

**ะัะพะฑะตะฝะฝะพััะธ:**
- Partial unique index ะฝะฐ `isOwner = true` ะณะฐัะฐะฝัะธััะตั ะตะดะธะฝััะฒะตะฝะฝะพะณะพ ะฒะปะฐะดะตะปััะฐ
- Soft delete ัะตัะตะท `@DeleteDateColumn` โ ะดะฐะฝะฝัะต ัะพััะฐะฝััััั ะฟะพัะปะต ัะดะฐะปะตะฝะธั
- `creationSource` ะพััะปะตะถะธะฒะฐะตั ะพัะบัะดะฐ ัะพะทะดะฐะฝะฐ ัััะฝะพััั

---

### Activity

> ๐ก **PARTIAL** โ extraction ัะพะทะดะฐัั ัะพะปัะบะพ PROJECT ะธ TASK; 9 ะฟะพะปะตะน (description, priority, context, deadline, startDate, endDate, tags, progress, lastActivityAt) ะฒัะตะณะดะฐ NULL; ััะฐััะฝะธะบะธ ะฒ metadata ะฒะผะตััะพ ActivityMember

**ะะพะฝัะตะบััั ะดะตััะตะปัะฝะพััะธ** โ ะธะตัะฐััะธัะตัะบะฐั ััััะบัััะฐ ะฒัะตั "ะดะตะป" ัะตะปะพะฒะตะบะฐ.

| ะะพะปะต | ะขะธะฟ | ะะฟะธัะฐะฝะธะต |
|------|-----|----------|
| `id` | uuid | ะฃะฝะธะบะฐะปัะฝัะน ะธะดะตะฝัะธัะธะบะฐัะพั |
| `name` | string(500) | ะะฐะทะฒะฐะฝะธะต |
| `activityType` | enum | ะขะธะฟ ะฐะบัะธะฒะฝะพััะธ (ัะผ. ะฝะธะถะต) |
| `description` | text? | ะะพะดัะพะฑะฝะพะต ะพะฟะธัะฐะฝะธะต |
| `status` | enum | ะกัะฐััั (ัะผ. ะฝะธะถะต) |
| `priority` | enum | `CRITICAL` \| `HIGH` \| `MEDIUM` \| `LOW` \| `NONE` |
| `context` | enum | `WORK` \| `PERSONAL` \| `ANY` \| `LOCATION_BASED` |
| `parentId` | uuid? | FK โ Activity (ัะพะดะธัะตะปั ะฒ ะธะตัะฐััะธะธ) |
| `depth` | int | ะะปัะฑะธะฝะฐ ะฒ ะดะตัะตะฒะต (0 = ะบะพัะตะฝั) |
| `materializedPath` | text? | ะััั ะพั ะบะพัะฝั: `uuid1/uuid2/uuid3` |
| `ownerEntityId` | uuid | FK โ Entity (ะฒะปะฐะดะตะปะตั, ะพะฑััะฝะพ isOwner=true) |
| `clientEntityId` | uuid? | FK โ Entity (ะบะปะธะตะฝั/ะทะฐะบะฐะทัะธะบ) |
| `deadline` | timestamp? | ะะตะดะปะฐะนะฝ |
| `startDate` | timestamp? | ะะฐัะฐ ะฝะฐัะฐะปะฐ |
| `endDate` | timestamp? | ะคะฐะบัะธัะตัะบะฐั ะดะฐัะฐ ะทะฐะฒะตััะตะฝะธั |
| `recurrenceRule` | string(100)? | Cron-ะฒััะฐะถะตะฝะธะต ะดะปั ะฟะพะฒัะพััััะธััั |
| `metadata` | jsonb? | ะะฐััะธััะตะผัะต ะผะตัะฐะดะฐะฝะฝัะต |
| `tags` | text[]? | ะขะตะณะธ ะดะปั ัะธะปัััะฐัะธะธ (GIN index) |
| `progress` | int? | ะัะพะณัะตัั 0-100% |
| `lastActivityAt` | timestamp? | ะะพัะปะตะดะฝัั ะฐะบัะธะฒะฝะพััั |
| `deletedAt` | timestamp? | Soft delete |

**ะคะฐะนะป:** `packages/entities/src/activity.entity.ts:115`

**ActivityType (ัะธะฟั ะฐะบัะธะฒะฝะพััะธ):**

| ะขะธะฟ | ะะฟะธัะฐะฝะธะต | ะัะธะผะตั |
|-----|----------|--------|
| `AREA` | ะกัะตัะฐ ะถะธะทะฝะธ | ะะฐะฑะพัะฐ, ะกะตะผัั, ะะดะพัะพะฒัะต |
| `BUSINESS` | ะะธะทะฝะตั/ะพัะณะฐะฝะธะทะฐัะธั | ะัะณะปะจะธัั.ัั, ะะพะฝัะฐะปัะธะฝะณ |
| `DIRECTION` | ะะฐะฟัะฐะฒะปะตะฝะธะต ะดะตััะตะปัะฝะพััะธ | YouTube-ะบะฐะฝะฐะป, ะัะพะดะฐะถะธ |
| `PROJECT` | ะัะพะตะบั ั ัะตะปัั ะธ ััะพะบะฐะผะธ | ะะธะดะตะพ ะฟัะพ ัะพัะผัะปั, ะฅะฐะฑ ะดะปั ะะธััะธะบั24 |
| `INITIATIVE` | ะะฝะธัะธะฐัะธะฒะฐ/ัะฟะธะบ ะฒะฝัััะธ ะฟัะพะตะบัะฐ | ะะตะดะธะทะฐะนะฝ ะธะฝัะตััะตะนัะฐ |
| `TASK` | ะะพะฝะบัะตัะฝะฐั ะทะฐะดะฐัะฐ | ะะฐัััะพะธัั webhooks |
| `MILESTONE` | ะะตัะฐ | ะะตะปะธะท v1.0 |
| `HABIT` | ะะพะฒัะพััััะฐััั ะฟัะธะฒััะบะฐ | ะฃััะตะฝะฝัั ะทะฐััะดะบะฐ |
| `LEARNING` | ะะฑััะตะฝะธะต/ะบััั | ะััั ะฟะพ TypeScript |
| `EVENT_SERIES` | ะกะตัะธั ัะพะฑััะธะน | ะะถะตะฝะตะดะตะปัะฝัะต ะฒัััะตัะธ |

**ActivityStatus (ััะฐัััั):**

| ะกัะฐััั | ะะฟะธัะฐะฝะธะต |
|--------|----------|
| `DRAFT` | ะงะตัะฝะพะฒะธะบ โ ะพะถะธะดะฐะตั ะฟะพะดัะฒะตัะถะดะตะฝะธั |
| `IDEA` | ะะดะตั, ะฝะต ะฝะฐัะฐัะฐ |
| `ACTIVE` | ะ ัะฐะฑะพัะต |
| `PAUSED` | ะะฐ ะฟะฐัะทะต |
| `COMPLETED` | ะะฐะฒะตััะตะฝะฐ ััะฟะตัะฝะพ |
| `CANCELLED` | ะัะผะตะฝะตะฝะฐ |
| `ARCHIVED` | ะ ะฐััะธะฒะต |

**ะะตะฐะปัะฝะพะต ะธัะฟะพะปัะทะพะฒะฐะฝะธะต ัะธะฟะพะฒ:**

> โ๏ธ Extraction pipeline (`extraction-persistence.service.ts`) ัะพะทะดะฐัั ัะพะปัะบะพ `PROJECT` ะธ `TASK`. ะััะฐะปัะฝัะต 8 ัะธะฟะพะฒ (AREA, BUSINESS, DIRECTION, INITIATIVE, MILESTONE, HABIT, LEARNING, EVENT_SERIES) ะพะฟัะตะดะตะปะตะฝั, ะฝะพ ะฝะต ัะพะทะดะฐัััั ะฐะฒัะพะผะฐัะธัะตัะบะธ. ะกะพะทะดะฐะฝะธะต ะฒัััะฝัั ัะตัะตะท API ัะตะพัะตัะธัะตัะบะธ ะฒะพะทะผะพะถะฝะพ, ะฝะพ ะฝะต ะฟัะพัะตััะธัะพะฒะฐะฝะพ.

**ะะตัะฐััะธั (ััะธ ะฟะฐััะตัะฝะฐ ะพะดะฝะพะฒัะตะผะตะฝะฝะพ):**

1. **Closure-table** (`@Tree('closure-table')`) โ ะดะปั `findAncestors()`/`findDescendants()` ัะตัะตะท `activities_closure`
2. **Adjacency List** (`parentId`) โ ะดะปั ะฟััะผะพะณะพ ะดะพัััะฟะฐ ะบ ัะพะดะธัะตะปั
3. **Materialized Path** (`materializedPath`) โ ะดะปั ะฑััััะพะณะพ LIKE-ะฟะพะธัะบะฐ ะฟะพัะพะผะบะพะฒ

> โ๏ธ **ะคะฐะบัะธัะตัะบะธ ะธัะฟะพะปัะทัะตััั ัะพะปัะบะพ Adjacency List** (`parentId`, `depth`). Closure-table ัะฐะฑะปะธัะฐ (`activities_closure`) ัะพะทะดะฐะฝะฐ ะผะธะณัะฐัะธะตะน, ะฝะพ TypeORM closure-table ะผะตัะพะดั ะฝะต ะฒัะทัะฒะฐัััั ะฒ ัะตัะฒะธัะฐั. Materialized path (`materializedPath`) ะทะฐะฟะพะปะฝัะตััั, ะฝะพ ะฝะต ะธัะฟะพะปัะทัะตััั ะฒ ะทะฐะฟัะพัะฐั. ะะตะบะพะผะตะฝะดะฐัะธั: ัะบะพะฝัะตะฝััะธัะพะฒะฐัััั ะฝะฐ Adjacency List, ะพััะฐะปัะฝะพะต ััะธัะฐัั ัะตัะฝะธัะตัะบะธะผ ะดะพะปะณะพะผ.

**ะัะธะผะตั ะธะตัะฐััะธะธ:**
```
ะะฐะฑะพัะฐ (AREA)
โโโ ะัะณะปะจะธัั.ัั (BUSINESS)
    โโโ YouTube-ะบะฐะฝะฐะป (DIRECTION)
        โโโ ะะธะดะตะพ ะฟัะพ ัะพัะผัะปั (PROJECT)
            โโโ ะะฐะฟะธัะฐัั ััะตะฝะฐัะธะน (TASK)
```

---

## ะััะธะฑััั ัะทะปะพะฒ (Node Properties)

### EntityFact

> ๐ข **PRODUCTION** โ ะฟะพะปะฝะพัััั ัะฐะฑะพัะฐะตั, ะธะทะฒะปะตัะตะฝะธะต + ะฒะตััะธะพะฝะธัะพะฒะฐะฝะธะต + dedup

**ะกัััะบัััะธัะพะฒะฐะฝะฝัะต ัะฐะบัั ะพ ััะฑัะตะบัะฐั** ั ะธััะพัะธะตะน ะธะทะผะตะฝะตะฝะธะน, ะฒะตััะธะพะฝะธัะพะฒะฐะฝะธะตะผ ะธ semantic deduplication.

| ะะพะปะต | ะขะธะฟ | ะะฟะธัะฐะฝะธะต |
|------|-----|----------|
| `id` | uuid | ะฃะฝะธะบะฐะปัะฝัะน ะธะดะตะฝัะธัะธะบะฐัะพั |
| `entityId` | uuid | FK โ Entity |
| `factType` | string(50) | ะขะธะฟ ัะฐะบัะฐ (ัะผ. ะฝะธะถะต) |
| `category` | enum | ะะฐัะตะณะพัะธั ัะฐะบัะฐ (ัะผ. ะฝะธะถะต) |
| `value` | string(500)? | ะขะตะบััะพะฒะพะต ะทะฝะฐัะตะฝะธะต |
| `valueDate` | date? | ะะฝะฐัะตะฝะธะต-ะดะฐัะฐ (ะดะปั birthday ะธ ั.ะฟ.) |
| `valueJson` | jsonb? | ะกัััะบัััะธัะพะฒะฐะฝะฝะพะต ะทะฝะฐัะตะฝะธะต |
| `source` | enum | `MANUAL` \| `EXTRACTED` \| `IMPORTED` |
| `confidence` | decimal(3,2)? | ะฃะฒะตัะตะฝะฝะพััั ะธะทะฒะปะตัะตะฝะธั 0.00-1.00 |
| `embedding` | vector(1536)? | Embedding ะดะปั semantic dedup |
| `sourceInteractionId` | uuid? | FK โ Interaction (ะธััะพัะฝะธะบ) |
| `rank` | enum | `preferred` \| `normal` \| `deprecated` |
| `supersededById` | uuid? | FK โ EntityFact (ะฝะพะฒะฐั ะฒะตััะธั) |
| `needsReview` | boolean | ะขัะตะฑัะตั ะฟัะพะฒะตัะบะธ (ะบะพะฝัะปะธะบั) |
| `reviewReason` | text? | ะัะธัะธะฝะฐ ะฟัะพะฒะตัะบะธ |
| `confirmationCount` | int | ะกะบะพะปัะบะพ ัะฐะท ะฟะพะดัะฒะตัะถะดัะฝ ะธะท ัะฐะทะฝัั ะธััะพัะฝะธะบะพะฒ |
| `validFrom` | date? | ะะฐัะฐะปะพ ะฟะตัะธะพะดะฐ ะดะตะนััะฒะธั |
| `validUntil` | date? | ะะพะฝะตั ะฟะตัะธะพะดะฐ ะดะตะนััะฒะธั |
| `status` | enum | `DRAFT` \| `ACTIVE` |
| `deletedAt` | timestamp? | Soft delete |

**ะคะฐะนะป:** `packages/entities/src/entity-fact.entity.ts:80`

**FactType (ัะธะฟั ัะฐะบัะพะฒ):**

| ะะฐัะตะณะพัะธั | ะขะธะฟั |
|-----------|------|
| Personal | `BIRTHDAY`, `NAME_FULL`, `NICKNAME` |
| Contact | `PHONE_WORK`, `PHONE_PERSONAL`, `EMAIL_WORK`, `EMAIL_PERSONAL`, `ADDRESS`, `TELEGRAM` |
| Professional | `POSITION`, `DEPARTMENT`, `COMPANY`, `SPECIALIZATION` |
| Business | `INN`, `KPP`, `OGRN`, `LEGAL_ADDRESS`, `ACTUAL_ADDRESS`, `BANK_ACCOUNT` |
| Preferences | `COMMUNICATION_PREFERENCE`, `TIMEZONE`, `LANGUAGE` |
| AI-generated | `DAILY_SUMMARY` |

**FactCategory:**
- `PERSONAL` โ ะปะธัะฝัะต ะดะฐะฝะฝัะต
- `CONTACT` โ ะบะพะฝัะฐะบัะฝะฐั ะธะฝัะพัะผะฐัะธั
- `PROFESSIONAL` โ ะฟัะพัะตััะธะพะฝะฐะปัะฝัะต ะดะฐะฝะฝัะต
- `BUSINESS` โ ะฑะธะทะฝะตั-ัะตะบะฒะธะทะธัั (ะดะปั ะพัะณะฐะฝะธะทะฐัะธะน)
- `LEGAL` โ ััะธะดะธัะตัะบะธะต ะดะฐะฝะฝัะต
- `FINANCIAL` โ ัะธะฝะฐะฝัะพะฒัะต ะดะฐะฝะฝัะต
- `PREFERENCES` โ ะฟัะตะดะฟะพััะตะฝะธั

**ะะตััะธะพะฝะธัะพะฒะฐะฝะธะต (Wikidata-style):**
- `rank: preferred` โ ะฐะบััะฐะปัะฝะพะต ะทะฝะฐัะตะฝะธะต
- `rank: normal` โ ะพะฑััะฝะพะต ะทะฝะฐัะตะฝะธะต
- `rank: deprecated` โ ัััะฐัะตะฒัะตะต ะทะฝะฐัะตะฝะธะต
- `supersededById` โ ัััะปะบะฐ ะฝะฐ ะฝะพะฒัั ะฒะตััะธั ัะฐะบัะฐ

---

### EntityIdentifier

> ๐ข **PRODUCTION** โ ะฟะพะปะฝะพัััั ัะฐะฑะพัะฐะตั

**ะะดะตะฝัะธัะธะบะฐัะพัั ะธะท ะฒะฝะตัะฝะธั ะธััะพัะฝะธะบะพะฒ** โ ัะฒัะทัะฒะฐัั telegram_user_id, phone, email ั Entity.

| ะะพะปะต | ะขะธะฟ | ะะฟะธัะฐะฝะธะต |
|------|-----|----------|
| `id` | uuid | ะฃะฝะธะบะฐะปัะฝัะน ะธะดะตะฝัะธัะธะบะฐัะพั |
| `entityId` | uuid | FK โ Entity |
| `identifierType` | string | ะขะธะฟ: `telegram_user_id`, `phone`, `email`, etc. |
| `identifierValue` | string | ะะฝะฐัะตะฝะธะต ะธะดะตะฝัะธัะธะบะฐัะพัะฐ |
| `isPrimary` | boolean | ะัะฝะพะฒะฝะพะน ะธะดะตะฝัะธัะธะบะฐัะพั ะดะฐะฝะฝะพะณะพ ัะธะฟะฐ |
| `metadata` | jsonb? | ะะพะฟะพะปะฝะธัะตะปัะฝัะต ะดะฐะฝะฝัะต |

**ะคะฐะนะป:** `packages/entities/src/entity-identifier.entity.ts`

**ะัะฟะพะปัะทะพะฒะฐะฝะธะต:**
- Entity Resolution โ ัะฒัะทัะฒะฐะฝะธะต ะฒัะพะดััะธั ะธะดะตะฝัะธัะธะบะฐัะพัะพะฒ ั Entity
- ะัะธ ะฝะตะธะทะฒะตััะฝะพะผ ะธะดะตะฝัะธัะธะบะฐัะพัะต ัะพะทะดะฐัััั `PendingEntityResolution`

---

## ะัะฑัะฐ ะณัะฐัะฐ (Edges)

### EntityRelation

> ๐ก **PARTIAL** โ entity ะธ ะฒะฐะปะธะดะฐัะธั ะฟะพะปะฝะพัััั ัะตะฐะปะธะทะพะฒะฐะฝั, ะฝะพ extraction pipeline ะฝะต ะฟะตััะธััะธั InferredRelations โ ะดะฐะฝะฝัะต ะธะทะฒะปะตะบะฐัััั LLM ะธ ัะตัััััั

**N-ะฐัะฝัะต ัะฒัะทะธ ะผะตะถะดั ััะฑัะตะบัะฐะผะธ** โ ัะตะผัั, ะดััะทัั, ัะฐะฑะพัะฐ, ะฟะฐััะฝััััะฒะฐ.

| ะะพะปะต | ะขะธะฟ | ะะฟะธัะฐะฝะธะต |
|------|-----|----------|
| `id` | uuid | ะฃะฝะธะบะฐะปัะฝัะน ะธะดะตะฝัะธัะธะบะฐัะพั |
| `relationType` | enum | ะขะธะฟ ัะฒัะทะธ (ัะผ. ะฝะธะถะต) |
| `metadata` | jsonb? | `{ since: '2020-01', note: 'ะฟะพะทะฝะฐะบะพะผะธะปะธัั ะฝะฐ ะบะพะฝัะตัะตะฝัะธะธ' }` |
| `source` | enum | `MANUAL` \| `EXTRACTED` \| `IMPORTED` \| `INFERRED` |
| `confidence` | decimal(3,2)? | ะฃะฒะตัะตะฝะฝะพััั 0.00-1.00 |
| `members[]` | relation | EntityRelationMember[] (ััะฐััะฝะธะบะธ ั ัะพะปัะผะธ) |

**ะคะฐะนะป:** `packages/entities/src/entity-relation.entity.ts:26`

**EntityRelationMember:**

| ะะพะปะต | ะขะธะฟ | ะะฟะธัะฐะฝะธะต |
|------|-----|----------|
| `id` | uuid | ะฃะฝะธะบะฐะปัะฝัะน ะธะดะตะฝัะธัะธะบะฐัะพั |
| `relationId` | uuid | FK โ EntityRelation |
| `entityId` | uuid | FK โ Entity |
| `role` | string | ะะพะปั ะฒ ัะฒัะทะธ |

**ะคะฐะนะป:** `packages/entities/src/entity-relation-member.entity.ts`

**RelationType ะธ ัะพะปะธ:**

| ะะฐัะตะณะพัะธั | ะขะธะฟ | ะะพะปะธ | ะะฐัะดะธะฝะฐะปัะฝะพััั |
|-----------|-----|------|----------------|
| **ะกะตะผัั** | `MARRIAGE` | spouse โ spouse | 2 |
| | `PARENTHOOD` | parent โ child | 2 |
| | `SIBLINGHOOD` | sibling โ sibling | 2-20 |
| **ะะฐะฑะพัะฐ** | `EMPLOYMENT` | employee โ employer | 2 |
| | `REPORTING` | subordinate โ manager | 2 |
| | `TEAM` | member*, lead | 2-100 |
| **ะกะพัะธะฐะปัะฝัะต** | `FRIENDSHIP` | friend โ friend | 2 |
| | `ACQUAINTANCE` | acquaintance | 2 |
| | `MENTORSHIP` | mentor โ mentee | 2 |
| **ะะธะทะฝะตั** | `PARTNERSHIP` | partner โ partner | 2-10 |
| | `CLIENT_VENDOR` | client โ vendor | 2 |

**ะคะฐะนะป:** `packages/entities/src/relation-type.enum.ts:5`

**ะัะธะผะตัั:**

```
# ะัะฐะบ (ะฑะธะฝะฐัะฝะฐั ัะฒัะทั)
EntityRelation { type: MARRIAGE, metadata: { since: '2015' } }
โโโ Member { entity: ะะฒะฐะฝ,  role: 'spouse' }
โโโ Member { entity: ะะฐัะธั, role: 'spouse' }

# ะะพะผะฐะฝะดะฐ (N-ะฐัะฝะฐั ัะฒัะทั)
EntityRelation { type: TEAM, metadata: { name: 'Backend Team' } }
โโโ Member { entity: ะััั, role: 'lead' }
โโโ Member { entity: ะะฒะฐะฝ, role: 'member' }
โโโ Member { entity: ะะฐัะธั, role: 'member' }

# ะกะตะผัั (ัะพะดะธัะตะปั-ัะตะฑัะฝะพะบ)
EntityRelation { type: PARENTHOOD }
โโโ Member { entity: ะะฒะฐะฝ,  role: 'parent' }
โโโ Member { entity: ะะปััะฐ, role: 'child' }
```

**ะะฐะปะธะดะฐัะธั:**
- `RELATION_ROLES[type]` โ ะดะพะฟัััะธะผัะต ัะพะปะธ ะดะปั ัะธะฟะฐ
- `RELATION_CARDINALITY[type]` โ min/max ััะฐััะฝะธะบะพะฒ
- `isValidRole(type, role)` โ ะฟัะพะฒะตัะบะฐ ัะพะปะธ
- `isValidCardinality(type, count)` โ ะฟัะพะฒะตัะบะฐ ะบะพะปะธัะตััะฒะฐ

---

### Commitment

> ๐ก **PARTIAL** โ ะธะทะฒะปะตะบะฐะตััั ะธะท ะฟะตัะตะฟะธัะบะธ, ะฝะพ `activityId` (FK โ Activity) ะฝะธะบะพะณะดะฐ ะฝะต ะทะฐะฟะพะปะฝัะตััั โ ะพะฑัะทะฐัะตะปัััะฒะฐ ะฝะต ะฟัะธะฒัะทะฐะฝั ะบ ะฟัะพะตะบัะฐะผ/ะทะฐะดะฐัะฐะผ

**ะะฑัะทะฐัะตะปัััะฒะฐ ะผะตะถะดั ััะฑัะตะบัะฐะผะธ** โ ะพะฑะตัะฐะฝะธั, ะทะฐะฟัะพัั, ัะพะณะปะฐัะตะฝะธั, ะฒัััะตัะธ.

| ะะพะปะต | ะขะธะฟ | ะะฟะธัะฐะฝะธะต |
|------|-----|----------|
| `id` | uuid | ะฃะฝะธะบะฐะปัะฝัะน ะธะดะตะฝัะธัะธะบะฐัะพั |
| `type` | enum | ะขะธะฟ ะพะฑัะทะฐัะตะปัััะฒะฐ (ัะผ. ะฝะธะถะต) |
| `title` | string(500) | ะัะฐัะบะพะต ะพะฟะธัะฐะฝะธะต |
| `description` | text? | ะะพะดัะพะฑะฝะพะต ะพะฟะธัะฐะฝะธะต |
| `status` | enum | ะกัะฐััั (ัะผ. ะฝะธะถะต) |
| `priority` | enum | `CRITICAL` \| `HIGH` \| `MEDIUM` \| `LOW` |
| `fromEntityId` | uuid | FK โ Entity (ะบัะพ ะดะฐะป ะพะฑะตัะฐะฝะธะต) |
| `toEntityId` | uuid | FK โ Entity (ะบะพะผั ะดะฐะฝะพ ะพะฑะตัะฐะฝะธะต) |
| `activityId` | uuid? | FK โ Activity (ะบะพะฝัะตะบัั) |
| `sourceMessageId` | uuid? | FK โ Message (ะธััะพัะฝะธะบ) |
| `extractedEventId` | uuid? | FK โ ExtractedEvent |
| `dueDate` | timestamp? | ะกัะพะบ ะฒัะฟะพะปะฝะตะฝะธั |
| `completedAt` | timestamp? | ะคะฐะบัะธัะตัะบะฐั ะดะฐัะฐ ะฒัะฟะพะปะฝะตะฝะธั |
| `recurrenceRule` | string(100)? | Cron ะดะปั ะฟะตัะธะพะดะธัะตัะบะธั |
| `nextReminderAt` | timestamp? | ะกะปะตะดัััะตะต ะฝะฐะฟะพะผะธะฝะฐะฝะธะต |
| `reminderCount` | int | ะะพะปะธัะตััะฒะพ ะฝะฐะฟะพะผะธะฝะฐะฝะธะน |
| `confidence` | float? | ะฃะฒะตัะตะฝะฝะพััั ะธะทะฒะปะตัะตะฝะธั |
| `metadata` | jsonb? | ะะพะฟะพะปะฝะธัะตะปัะฝัะต ะดะฐะฝะฝัะต |
| `notes` | text? | ะััะฝัะต ะทะฐะผะตัะบะธ |
| `deletedAt` | timestamp? | Soft delete |

**ะคะฐะนะป:** `packages/entities/src/commitment.entity.ts:92`

**CommitmentType:**

| ะขะธะฟ | ะะฟะธัะฐะฝะธะต | ะัะธะผะตั |
|-----|----------|--------|
| `PROMISE` | ะะฑะตัะฐะฝะธะต ััะพ-ัะพ ัะดะตะปะฐัั | "ะฏ ะฟัะธัะปั ะพัััั ะดะพ ะฟััะฝะธัั" |
| `REQUEST` | ะะฐะฟัะพั ะพั ะดััะณะพะณะพ ัะตะปะพะฒะตะบะฐ | "ะะฐัั ะฟะพะฟัะพัะธะป ัะตะฒัั" |
| `AGREEMENT` | ะะทะฐะธะผะฝะพะต ัะพะณะปะฐัะตะฝะธะต | "ะะพะณะพะฒะพัะธะปะธัั ะพ ัะตะฝะต" |
| `DEADLINE` | ะะตะดะปะฐะนะฝ | "ะกะดะฐัั ะฟัะพะตะบั ะดะพ 1 ะผะฐััะฐ" |
| `REMINDER` | ะะฐะฟะพะผะธะฝะฐะฝะธะต | "ะะฐะฟะพะผะฝะธัั ะฟะพะทะฒะพะฝะธัั" |
| `RECURRING` | ะะตัะธะพะดะธัะตัะบะฐั ะทะฐะดะฐัะฐ | "ะะถะตะฝะตะดะตะปัะฝัะน ะพัััั" |
| `MEETING` | ะัััะตัะฐ | "ะกะพะทะฒะพะฝ ะฒ 15:00" |

**CommitmentStatus:**

| ะกัะฐััั | ะะฟะธัะฐะฝะธะต |
|--------|----------|
| `DRAFT` | ะะถะธะดะฐะตั ะฟะพะดัะฒะตัะถะดะตะฝะธั |
| `PENDING` | ะะถะธะดะฐะตั ะฒัะฟะพะปะฝะตะฝะธั |
| `IN_PROGRESS` | ะ ะฟัะพัะตััะต |
| `COMPLETED` | ะัะฟะพะปะฝะตะฝะพ |
| `CANCELLED` | ะัะผะตะฝะตะฝะพ |
| `OVERDUE` | ะัะพััะพัะตะฝะพ |
| `DEFERRED` | ะัะปะพะถะตะฝะพ |

**ะะฐะฟัะฐะฒะปะตะฝะฝะพััั:**
- `fromEntityId โ toEntityId` โ ะฝะฐะฟัะฐะฒะปะตะฝะฝะพะต ัะตะฑัะพ
- "ะะฐัั ะพะฑะตัะฐะป ะผะฝะต" โ from: ะะฐัั, to: ะฏ
- "ะฏ ะพะฑะตัะฐะป ะะฐัะต" โ from: ะฏ, to: ะะฐัั

---

### ActivityMember

> ๐ด **DORMANT** โ entity ัะฐะนะป ะธ ะผะธะณัะฐัะธั ัััะตััะฒััั, `activity.service.ts` ะธะฝะถะตะบัะธััะตั ัะตะฟะพะทะธัะพัะธะน, ะฝะพ **ะฝะธ ะพะดะธะฝ ัะตัะฒะธั ะฝะต ัะพะทะดะฐัั ะทะฐะฟะธัะธ**. ะฃัะฐััะฝะธะบะธ ััะฐะฝัััั ะบะฐะบ `Activity.metadata.participants: string[]` (ะฝะตัะตะทะพะปะฒะปะตะฝะฝัะต ะธะผะตะฝะฐ)

**ะฃัะฐััะธะต Entity ะฒ Activity** โ ัะฒัะทั ะผะฝะพะณะธะต-ะบะพ-ะผะฝะพะณะธะผ ั ัะพะปัะผะธ.

| ะะพะปะต | ะขะธะฟ | ะะฟะธัะฐะฝะธะต |
|------|-----|----------|
| `id` | uuid | ะฃะฝะธะบะฐะปัะฝัะน ะธะดะตะฝัะธัะธะบะฐัะพั |
| `activityId` | uuid | FK โ Activity |
| `entityId` | uuid | FK โ Entity |
| `role` | enum | ะะพะปั ััะฐััะฝะธะบะฐ (ัะผ. ะฝะธะถะต) |
| `notes` | text? | ะะฐะผะตัะบะธ ะพ ัะพะปะธ |
| `isActive` | boolean | ะะบัะธะฒะตะฝ ะปะธ ััะฐััะฝะธะบ |
| `joinedAt` | timestamp? | ะะฐัะฐ ะฟัะธัะพะตะดะธะฝะตะฝะธั |
| `leftAt` | timestamp? | ะะฐัะฐ ะฒััะพะดะฐ |
| `metadata` | jsonb? | permissions, preferences, etc. |

**ะคะฐะนะป:** `packages/entities/src/activity-member.entity.ts:49`

**ActivityMemberRole:**

| ะะพะปั | ะะฟะธัะฐะฝะธะต |
|------|----------|
| `OWNER` | ะะปะฐะดะตะปะตั/ะพัะฒะตัััะฒะตะฝะฝัะน |
| `MEMBER` | ะฃัะฐััะฝะธะบ |
| `OBSERVER` | ะะฐะฑะปัะดะฐัะตะปั (ัะพะปัะบะพ ััะตะฝะธะต) |
| `ASSIGNEE` | ะัะฟะพะปะฝะธัะตะปั |
| `REVIEWER` | ะะตะฒััะตั |
| `CLIENT` | ะะปะธะตะฝั/ะทะฐะบะฐะทัะธะบ |
| `CONSULTANT` | ะะพะฝััะปััะฐะฝั |

**ะัะธะผะตั:**
```
ะัะพะตะบั "ะฅะฐะฑ ะดะปั ะะธััะธะบั24":
โโโ ActivityMember { entity: ะฏ,        role: OWNER }
โโโ ActivityMember { entity: ะะฐะฝะฐะฒัะพ,  role: CLIENT }
โโโ ActivityMember { entity: ะะฐัั,     role: MEMBER }
โโโ ActivityMember { entity: ะขะธะผะปะธะด,   role: REVIEWER }
```

**Unique constraint:** `(activityId, entityId, role)` โ ะพะดะธะฝ Entity ะผะพะถะตั ะธะผะตัั ะฝะตัะบะพะปัะบะพ ัะพะปะตะน ะฒ ะพะดะฝะพะน Activity.

---

## ะะณัะตะณะธัะพะฒะฐะฝะฝัะต ะทะฝะฐะฝะธั (Summaries)

### EntityRelationshipProfile

> ๐ข **PRODUCTION** โ ะฟะพะปะฝะพัััั ัะฐะฑะพัะฐะตั, ะณะตะฝะตัะธััะตััั ะฐะฒัะพะผะฐัะธัะตัะบะธ

**ะัะพัะธะปั ะฒะทะฐะธะผะพะพัะฝะพัะตะฝะธะน ั Entity** โ ะฒััะพะบะพััะพะฒะฝะตะฒะพะต ะทะฝะฐะฝะธะต ะพ ัะตะปะพะฒะตะบะต/ะพัะณะฐะฝะธะทะฐัะธะธ.

| ะะพะปะต | ะขะธะฟ | ะะฟะธัะฐะฝะธะต |
|------|-----|----------|
| `id` | uuid | ะฃะฝะธะบะฐะปัะฝัะน ะธะดะตะฝัะธัะธะบะฐัะพั |
| `entityId` | uuid | FK โ Entity (unique โ ะพะดะธะฝ ะฟัะพัะธะปั ะฝะฐ Entity) |
| `relationshipType` | enum | ะขะธะฟ ะพัะฝะพัะตะฝะธะน (ัะผ. ะฝะธะถะต) |
| `communicationFrequency` | enum | ะงะฐััะพัะฐ ะพะฑัะตะฝะธั (ัะผ. ะฝะธะถะต) |
| `relationshipSummary` | text | ะขะตะบััะพะฒะพะต ะพะฟะธัะฐะฝะธะต ะพัะฝะพัะตะฝะธะน |
| `relationshipTimeline` | text? | ะฅัะพะฝะพะปะพะณะธั ะพัะฝะพัะตะฝะธะน |
| `firstInteractionDate` | timestamp | ะะฐัะฐ ะฟะตัะฒะพะณะพ ะฒะทะฐะธะผะพะดะตะนััะฒะธั |
| `lastMeaningfulContact` | timestamp | ะะพัะปะตะดะฝะธะน ะทะฝะฐัะธะผัะน ะบะพะฝัะฐะบั |
| `totalInteractions` | int | ะะฑัะตะต ะบะพะปะธัะตััะฒะพ ะฒะทะฐะธะผะพะดะตะนััะฒะธะน |
| `totalMessages` | int | ะะฑัะตะต ะบะพะปะธัะตััะฒะพ ัะพะพะฑัะตะฝะธะน |
| `topTopics` | jsonb | ะัะฝะพะฒะฝัะต ัะตะผั ะพะฑััะถะดะตะฝะธะน (string[]) |
| `milestones` | jsonb | ะะตัะธ ะพัะฝะพัะตะฝะธะน (ัะผ. ะฝะธะถะต) |
| `keyDecisions` | jsonb | ะะปััะตะฒัะต ัะตัะตะฝะธั (ัะผ. ะฝะธะถะต) |
| `openActionItems` | jsonb | ะัะบััััะต action items (ัะผ. ะฝะธะถะต) |
| `summarizedInteractionsCount` | int | ะะพะปะธัะตััะฒะพ ััะผะผะฐัะธะทะธัะพะฒะฐะฝะฝัั ะฒะทะฐะธะผะพะดะตะนััะฒะธะน |
| `coverageStart` | timestamp | ะะฐัะฐะปะพ ะฟะพะบัััะธั |
| `coverageEnd` | timestamp | ะะพะฝะตั ะฟะพะบัััะธั |
| `modelVersion` | string(50)? | ะะตััะธั ะผะพะดะตะปะธ ะณะตะฝะตัะฐัะธะธ |

**ะคะฐะนะป:** `packages/entities/src/entity-relationship-profile.entity.ts:48`

**RelationshipType:**
- `client` โ ะบะปะธะตะฝั
- `partner` โ ะฟะฐััะฝัั
- `colleague` โ ะบะพะปะปะตะณะฐ
- `friend` โ ะดััะณ
- `acquaintance` โ ะทะฝะฐะบะพะผัะน
- `vendor` โ ะฟะพััะฐะฒัะธะบ
- `other` โ ะดััะณะพะต

**CommunicationFrequency:**
- `daily` โ ะตะถะตะดะฝะตะฒะฝะพ
- `weekly` โ ะตะถะตะฝะตะดะตะปัะฝะพ
- `monthly` โ ะตะถะตะผะตัััะฝะพ
- `quarterly` โ ัะฐะท ะฒ ะบะฒะฐััะฐะป
- `rare` โ ัะตะดะบะพ

**RelationshipMilestone:**
```typescript
{
  date: string;        // "2024-01-15"
  title: string;       // "ะะพะดะฟะธัะฐะฝะธะต ะบะพะฝััะฐะบัะฐ"
  description: string; // "ะะพะดะฟะธัะฐะปะธ ะดะพะณะพะฒะพั ะฝะฐ 1 ะณะพะด"
}
```

**KeyDecision:**
```typescript
{
  date: string;           // "2024-02-01"
  description: string;    // "ะกะพะณะปะฐัะพะฒะฐะปะธ ะฑัะดะถะตั"
  quote?: string | null;  // "ะะบะตะน, 500ะบ ะฝะฐั ััััะฐะธะฒะฐะตั"
}
```

**OpenActionItem:**
```typescript
{
  description: string;           // "ะัะธัะปะฐัั ะะ"
  owner: 'self' | 'them' | 'both'; // ะัะพ ะพัะฒะตัััะฒะตะฝะฝัะน
}
```

---

### InteractionSummary

> ๐ข **PRODUCTION** โ ะฟะพะปะฝะพัััั ัะฐะฑะพัะฐะตั, ะณะตะฝะตัะธััะตััั ะฐะฒัะพะผะฐัะธัะตัะบะธ

**ะกะฐะผะผะฐัะธ ัะตััะธะธ ะพะฑัะตะฝะธั** โ ััััะบัััะธัะพะฒะฐะฝะฝะพะต ัะตะทัะผะต Interaction.

| ะะพะปะต | ะขะธะฟ | ะะฟะธัะฐะฝะธะต |
|------|-----|----------|
| `id` | uuid | ะฃะฝะธะบะฐะปัะฝัะน ะธะดะตะฝัะธัะธะบะฐัะพั |
| `interactionId` | uuid | FK โ Interaction (unique) |
| `summaryText` | text | ะขะตะบััะพะฒะพะต ัะตะทัะผะต |
| `keyPoints` | jsonb | ะะปััะตะฒัะต ะฟัะฝะบัั (string[]) |
| `tone` | enum? | ะขะพะฝ ะพะฑัะตะฝะธั (ัะผ. ะฝะธะถะต) |
| `decisions` | jsonb | ะะตัะตะฝะธั (ัะผ. ะฝะธะถะต) |
| `actionItems` | jsonb | Action items (ัะผ. ะฝะธะถะต) |
| `importantMessages` | jsonb | ะะฐะถะฝัะต ัะพะพะฑัะตะฝะธั (ัะผ. ะฝะธะถะต) |
| `factsExtracted` | jsonb? | ะะทะฒะปะตััะฝะฝัะต ัะฐะบัั |
| `messageCount` | int? | ะะพะปะธัะตััะฒะพ ัะพะพะฑัะตะฝะธะน |
| `sourceTokenCount` | int? | ะขะพะบะตะฝะพะฒ ะฒ ะธััะพัะฝะธะบะต |
| `summaryTokenCount` | int? | ะขะพะบะตะฝะพะฒ ะฒ ัะฐะผะผะฐัะธ |
| `compressionRatio` | decimal(5,2)? | ะะพัััะธัะธะตะฝั ัะถะฐัะธั |
| `modelVersion` | string(50)? | ะะตััะธั ะผะพะดะตะปะธ |
| `generationCostUsd` | decimal(10,6)? | ะกัะพะธะผะพััั ะณะตะฝะตัะฐัะธะธ |
| `revisionCount` | int | ะะพะผะตั ัะตะฒะธะทะธะธ |
| `embedding` | vector(1536)? | Embedding ะดะปั semantic search |

**ะคะฐะนะป:** `packages/entities/src/interaction-summary.entity.ts:38`

**ToneType:**
- `positive` โ ะฟะพะทะธัะธะฒะฝัะน
- `neutral` โ ะฝะตะนััะฐะปัะฝัะน
- `negative` โ ะฝะตะณะฐัะธะฒะฝัะน
- `formal` โ ัะพัะผะฐะปัะฝัะน
- `informal` โ ะฝะตัะพัะผะฐะปัะฝัะน

**Decision:**
```typescript
{
  description: string;                    // "ะกะพะณะปะฐัะพะฒะฐะปะธ ะฐััะธัะตะบัััั"
  date: string | null;                    // "2024-01-15"
  importance: 'high' | 'medium' | 'low';  // ะะฐะถะฝะพััั
  quote?: string;                         // ะฆะธัะฐัะฐ ะธะท ะฟะตัะตะฟะธัะบะธ
}
```

**ActionItem:**
```typescript
{
  description: string;           // "ะัะธัะปะฐัั ะขะ"
  owner: 'self' | 'them' | 'both';
  status: 'open' | 'closed';
  dueDate?: string;              // "2024-01-20"
  closedAt?: string;             // "2024-01-18"
}
```

**ImportantMessageRef:**
```typescript
{
  messageId: string;    // UUID ัะพะพะฑัะตะฝะธั
  content: string;      // ะขะตะบัั
  timestamp: string;    // ISO timestamp
  reason: 'decision' | 'agreement' | 'deadline' | 'important_info';
}
```

---

## ะััะพัะฝะธะบะธ ะดะฐะฝะฝัั (Raw Data)

### Interaction

> ๐ข **PRODUCTION** โ ะฟะพะปะฝะพัััั ัะฐะฑะพัะฐะตั

**ะกะตััะธั ะพะฑัะตะฝะธั** โ ะบะพะฝัะตะนะฝะตั ะดะปั ัะพะพะฑัะตะฝะธะน, ััะฐะฝัะบัะธะฟัะธะน.

| ะะพะปะต | ะขะธะฟ | ะะฟะธัะฐะฝะธะต |
|------|-----|----------|
| `id` | uuid | ะฃะฝะธะบะฐะปัะฝัะน ะธะดะตะฝัะธัะธะบะฐัะพั |
| `type` | enum | `TELEGRAM_SESSION` \| `PHONE_CALL` \| `VIDEO_MEETING` |
| `source` | enum | `TELEGRAM` \| `MANUAL_UPLOAD` \| `GOOGLE_MEET` \| `ZOOM` |
| `status` | enum | `ACTIVE` \| `COMPLETED` \| `PENDING_REVIEW` \| `PROCESSING` \| `ERROR` |
| `startedAt` | timestamp | ะะฐัะฐะปะพ ัะตััะธะธ |
| `endedAt` | timestamp? | ะะพะฝะตั ัะตััะธะธ |
| `sourceMetadata` | jsonb? | ะะตัะฐะดะฐะฝะฝัะต ะธััะพัะฝะธะบะฐ (ัะผ. ะฝะธะถะต) |
| `participants[]` | relation | InteractionParticipant[] |
| `messages[]` | relation | Message[] |
| `transcriptSegments[]` | relation | TranscriptSegment[] |
| `summary` | relation | InteractionSummary? |

**ะคะฐะนะป:** `packages/entities/src/interaction.entity.ts:39`

**sourceMetadata:**
```typescript
{
  // Telegram
  telegram_chat_id?: string;
  chat_type?: 'private' | 'group' | 'supergroup';

  // Phone call
  phone_number?: string;
  direction?: 'incoming' | 'outgoing';
  duration_seconds?: number;
  audio_file_path?: string;

  // Video meeting
  meeting_url?: string;
  meeting_id?: string;
  platform?: string;
}
```

**Session Management:**
- ะะพะฒะฐั ัะตััะธั ัะพะทะดะฐัััั ะฟัะธ gap > 4 ัะฐัะพะฒ ะผะตะถะดั ัะพะพะฑัะตะฝะธัะผะธ
- `ACTIVE` โ `COMPLETED` ะบะพะณะดะฐ gap ะฟัะตะฒััะตะฝ

---

### Message

> ๐ข **PRODUCTION** โ ะฟะพะปะฝะพัััั ัะฐะฑะพัะฐะตั

**ะกะพะพะฑัะตะฝะธะต** โ ะฐัะพะผะฐัะฝะฐั ะตะดะธะฝะธัะฐ ะพะฑัะตะฝะธั.

| ะะพะปะต | ะขะธะฟ | ะะฟะธัะฐะฝะธะต |
|------|-----|----------|
| `id` | uuid | ะฃะฝะธะบะฐะปัะฝัะน ะธะดะตะฝัะธัะธะบะฐัะพั |
| `interactionId` | uuid | FK โ Interaction |
| `senderEntityId` | uuid | FK โ Entity (ะฐะฒัะพั) |
| `content` | text | ะขะตะบัั ัะพะพะฑัะตะฝะธั |
| `timestamp` | timestamp | ะัะตะผั ะพัะฟัะฐะฒะบะธ |
| `sourceMessageId` | string? | ID ะฒ ะธััะพัะฝะธะบะต (telegram message_id) |
| `embedding` | vector(1536)? | Embedding ะดะปั semantic search |
| `metadata` | jsonb? | ะะพะฟะพะปะฝะธัะตะปัะฝัะต ะดะฐะฝะฝัะต |

**ะคะฐะนะป:** `packages/entities/src/message.entity.ts`

---

### TranscriptSegment

> ๐ข **PRODUCTION** โ ะฟะพะปะฝะพัััั ัะฐะฑะพัะฐะตั

**ะกะตะณะผะตะฝั ััะฐะฝัะบัะธะฟัะธะธ** โ ัะฐััั ััะฐะฝัะบัะธะฑะธัะพะฒะฐะฝะฝะพะณะพ ะทะฒะพะฝะบะฐ/ะฒะธะดะตะพ.

| ะะพะปะต | ะขะธะฟ | ะะฟะธัะฐะฝะธะต |
|------|-----|----------|
| `id` | uuid | ะฃะฝะธะบะฐะปัะฝัะน ะธะดะตะฝัะธัะธะบะฐัะพั |
| `interactionId` | uuid | FK โ Interaction |
| `speakerEntityId` | uuid? | FK โ Entity (ะบัะพ ะณะพะฒะพัะธั) |
| `speakerLabel` | string? | ะะตัะบะฐ ัะฟะธะบะตัะฐ ะดะพ resolution |
| `content` | text | ะขะตะบัั ัะตะณะผะตะฝัะฐ |
| `startTime` | float | ะะฐัะฐะปะพ ะฒ ัะตะบัะฝะดะฐั |
| `endTime` | float | ะะพะฝะตั ะฒ ัะตะบัะฝะดะฐั |
| `confidence` | float? | ะฃะฒะตัะตะฝะฝะพััั ััะฐะฝัะบัะธะฟัะธะธ |
| `embedding` | vector(1536)? | Embedding |

**ะคะฐะนะป:** `packages/entities/src/transcript-segment.entity.ts`

---

## ะะปะฐะฝะธััะตะผัะต ัััะฝะพััะธ (Phase E)

### TopicalSegment

> โช **PLANNED** (Phase E) โ ะฝะตั ะฝะธ entity ัะฐะนะปะฐ, ะฝะธ ะผะธะณัะฐัะธะธ

**ะกะตะผะฐะฝัะธัะตัะบะธะน ัะตะณะผะตะฝั ะพะฑััะถะดะตะฝะธั** โ ะณััะฟะฟะธัะพะฒะบะฐ ัะพะพะฑัะตะฝะธะน ะฟะพ ัะตะผะต.

| ะะพะปะต | ะขะธะฟ | ะะฟะธัะฐะฝะธะต |
|------|-----|----------|
| `id` | uuid | ะฃะฝะธะบะฐะปัะฝัะน ะธะดะตะฝัะธัะธะบะฐัะพั |
| `topic` | string(200) | ะัะฐัะบะฐั ัะตะผะฐ |
| `summary` | text | ะะตะทัะผะต ะพะฑััะถะดะตะฝะธั |
| `activityId` | uuid? | FK โ Activity (ะพะฟัะธะพะฝะฐะปัะฝะฐั ะฟัะธะฒัะทะบะฐ) |
| `participants` | jsonb | Entity IDs ััะฐััะฝะธะบะพะฒ |
| `sentiment` | enum? | ะขะพะฝะฐะปัะฝะพััั ะพะฑััะถะดะตะฝะธั |
| `startedAt` | timestamp | ะะฐัะฐะปะพ ัะตะณะผะตะฝัะฐ |
| `endedAt` | timestamp | ะะพะฝะตั ัะตะณะผะตะฝัะฐ |
| `messageCount` | int | ะะพะปะธัะตััะฒะพ ัะพะพะฑัะตะฝะธะน |
| `embedding` | vector(1536)? | Embedding ัะตะผั |
| `messages[]` | relation | Message[] (many-to-many) |

**ะคะฐะนะป:** `docs/second-brain/06-PHASE-E-KNOWLEDGE-PACKING.md`

**ะัะปะธัะธะต ะพั Interaction:**
- Interaction โ ัะตัะฝะธัะตัะบะฐั ัะตััะธั (gap > 4ั)
- TopicalSegment โ ัะตะผะฐะฝัะธัะตัะบะฐั ะณััะฟะฟะธัะพะฒะบะฐ (ะพะดะฝะฐ ัะตะผะฐ)
- ะ ะพะดะฝะพะน Interaction ะผะพะถะตั ะฑััั ะฝะตัะบะพะปัะบะพ TopicalSegment
- ะะดะธะฝ TopicalSegment ะผะพะถะตั ะพัะฒะฐััะฒะฐัั ะฝะตัะบะพะปัะบะพ Interaction

---

### KnowledgePack

> โช **PLANNED** (Phase E) โ ะฝะตั ะฝะธ entity ัะฐะนะปะฐ, ะฝะธ ะผะธะณัะฐัะธะธ

**ะะพะฝัะพะปะธะดะธัะพะฒะฐะฝะฝัะต ะทะฝะฐะฝะธั ะฟะพ Activity** โ ัะฟะฐะบะพะฒะบะฐ ะทะฝะฐะฝะธะน ะทะฐ ะฟะตัะธะพะด.

| ะะพะปะต | ะขะธะฟ | ะะฟะธัะฐะฝะธะต |
|------|-----|----------|
| `id` | uuid | ะฃะฝะธะบะฐะปัะฝัะน ะธะดะตะฝัะธัะธะบะฐัะพั |
| `activityId` | uuid | FK โ Activity |
| `periodStart` | timestamp | ะะฐัะฐะปะพ ะฟะตัะธะพะดะฐ |
| `periodEnd` | timestamp | ะะพะฝะตั ะฟะตัะธะพะดะฐ |
| `summary` | text | ะะฑัะตะต ัะตะทัะผะต |
| `keyFacts` | jsonb | ะะปััะตะฒัะต ัะฐะบัั (string[]) |
| `openQuestions` | jsonb | ะัะบััััะต ะฒะพะฟัะพัั (string[]) |
| `decisions` | jsonb | ะัะธะฝัััะต ัะตัะตะฝะธั |
| `risks` | jsonb | ะััะฒะปะตะฝะฝัะต ัะธัะบะธ |
| `sourceSegmentIds` | jsonb | UUID[] ัะตะณะผะตะฝัะพะฒ-ะธััะพัะฝะธะบะพะฒ |
| `embedding` | vector(1536)? | Embedding ะดะปั ะฟะพะธัะบะฐ |

**ะคะฐะนะป:** `docs/second-brain/06-PHASE-E-KNOWLEDGE-PACKING.md`

**ะะฐะทะฝะฐัะตะฝะธะต:**
- ะะตััะพัะฟะตะบัะธะฒะฝัะน ะฐะฝะฐะปะธะท ะทะฝะฐะฝะธะน
- ะกะถะฐัะธะต ะธ ะพะฑัะตะดะธะฝะตะฝะธะต ััะพะถะธั ะทะฝะฐะฝะธะน
- ะะตัะตะฟัะพะฒะตัะบะฐ ะธ ะฒะฐะปะธะดะฐัะธั ัะฐะบัะพะฒ
- "ะััะทะฐะตะผัะน ะบะพะฝัะตะบัั" ะฟะพ Activity

---

## ะกะธััะตะผะฝัะต ะฟัะพะฑะปะตะผั ะธ ะฟะปะฐะฝ ััััะฐะฝะตะฝะธั

> ะััะฒะปะตะฝะพ 2025-02-05 ะฟัะธ ะฐัะดะธัะต ัะฐััะพะถะดะตะฝะธะน ะผะตะถะดั ััะธะผ ะดะพะบัะผะตะฝัะพะผ ะธ ัะตะฐะปัะฝัะผ ัะพััะพัะฝะธะตะผ ะบะพะดะฐ. ะะตัะฐะปัะฝัะน ะฟะปะฐะฝ ััััะฐะฝะตะฝะธั: [`docs/plans/2025-02-05-project-creation-improvements-plan.md`](./plans/2025-02-05-project-creation-improvements-plan.md)

### ะัะพะฑะปะตะผะฐ 1: ะะพะบัะผะตะฝั ะฝะต ัะฐะทะปะธัะฐะตั "ะพะฟัะตะดะตะปะตะฝะพ" ะธ "ัะฐะฑะพัะฐะตั"

**ะกััั:** ะะพ ััะพะณะพ ะพะฑะฝะพะฒะปะตะฝะธั ะฒัะต entity ะพะฟะธััะฒะฐะปะธัั ะพะดะธะฝะฐะบะพะฒะพ, ะฑะตะท ัะบะฐะทะฐะฝะธั ัะตะฐะปัะฝะพะณะพ ัะพััะพัะฝะธั. ะญัะพ ัะพะทะดะฐะฒะฐะปะพ ะธะปะปัะทะธั, ััะพ ะฒะตัั ะณัะฐั ัะฐะฑะพัะฐะตั, ัะพัั ัะฐััั entity โ "ัะฟััะธะต".

**ะะตัะตะฝะธะต (ะฒัะฟะพะปะฝะตะฝะพ):** ะะพะฑะฐะฒะปะตะฝั ััะฐัััั ัะตะฐะปะธะทะฐัะธะธ (๐ข๐ก๐ดโช) ะบ ะบะฐะถะดะพะน entity ะธ ัะฒะพะดะฝะฐั ะผะฐััะธัะฐ ะณะพัะพะฒะฝะพััะธ ะฒ ะฝะฐัะฐะปะต ะดะพะบัะผะตะฝัะฐ. ะขะตะฟะตัั ะฟัะธ ััะตะฝะธะธ KG ััะฐะทั ะฟะพะฝััะฝะพ, ััะพ ัะฐะฑะพัะฐะตั, ะฐ ััะพ โ ัะตะปะตะฒะพะต ัะพััะพัะฝะธะต.

**ะัะฐะฒะธะปะพ ะฝะฐ ะฑัะดััะตะต:** ะัะธ ะดะพะฑะฐะฒะปะตะฝะธะธ ะฝะพะฒะพะน entity ะฒ KG ะดะพะบัะผะตะฝั ะพะฑัะทะฐัะตะปัะฝะพ ัะบะฐะทัะฒะฐัั ัะตะบััะธะน Implementation Status. ะะฑะฝะพะฒะปััั ััะฐััั ะฟัะธ ะบะฐะถะดะพะผ ะทะฝะฐัะธัะตะปัะฝะพะผ ะธะทะผะตะฝะตะฝะธะธ ะฒ ะบะพะดะต.

### ะัะพะฑะปะตะผะฐ 2: ะะทะฑััะพัะฝะพััั ะฟะฐััะตัะฝะพะฒ ะดะตัะตะฒะฐ Activity

**ะกััั:** Activity ะธัะฟะพะปัะทัะตั ััะธ ะฟะฐััะตัะฝะฐ ะดะตัะตะฒะฐ ะพะดะฝะพะฒัะตะผะตะฝะฝะพ:
1. Closure-table (TypeORM `@Tree('closure-table')`) โ ัะฐะฑะปะธัะฐ `activities_closure`
2. Adjacency List (`parentId` + `depth`)
3. Materialized Path (`materializedPath`)

ะคะฐะบัะธัะตัะบะธ ะธัะฟะพะปัะทัะตััั ัะพะปัะบะพ Adjacency List. Closure-table ัะฐะฑะปะธัะฐ ัะพะทะดะฐะฝะฐ ะผะธะณัะฐัะธะตะน, ะฝะพ ะตั ะผะตัะพะดั (`findAncestors`, `findDescendants`) ะฝะต ะฒัะทัะฒะฐัััั. Materialized path ะทะฐะฟะพะปะฝัะตััั, ะฝะพ ะฝะต ััะฐััะฒัะตั ะฒ ะทะฐะฟัะพัะฐั.

**ะะธัะบะธ:**
- ะขัััะบัะฐัะฝะพะต ะดัะฑะปะธัะพะฒะฐะฝะธะต ะดะฐะฝะฝัั (ัะฐะทะผะตั ะะ)
- Bug ะฒ TypeORM 0.3.x: `repository.save()` ั closure-table ะผะพะถะตั ะฟะฐะดะฐัั โ ะฝัะถะตะฝ `QueryBuilder.insert()`
- ะกะปะพะถะฝะพััั ะฟะพะดะดะตัะถะบะธ โ ะฟัะธ ะธะทะผะตะฝะตะฝะธะธ ััััะบัััั ะฝะฐะดะพ ะพะฑะฝะพะฒะปััั ััะธ ะธััะพัะฝะธะบะฐ

**ะะปะฐะฝ ััััะฐะฝะตะฝะธั:**
1. **ะัะฐัะบะพััะพัะฝะพ:** ะััะฐะฒะธัั ะบะฐะบ ะตััั, ะดะพะฑะฐะฒะธัั ะฟัะตะดัะฟัะตะถะดะตะฝะธะต ะฒ ะดะพะบัะผะตะฝัะฐัะธั (ะฒัะฟะพะปะฝะตะฝะพ ะฒััะต)
2. **ะกัะตะดะฝะตััะพัะฝะพ:** ะัะตะฝะธัั, ะฝัะถะตะฝ ะปะธ ะฒะพะพะฑัะต closure-table. ะัะปะธ hierarchical queries ะฟะพััะตะฑััััั โ ัะตะฐะปะธะทะพะฒะฐัั ะฝะฐ ะฑะฐะทะต `materializedPath` (LIKE-ะฟะพะธัะบ) ะธะปะธ recursive CTE, ััะพ ะฟัะพัะต ะธ ะฝะต ััะตะฑัะตั ะพัะดะตะปัะฝะพะน ัะฐะฑะปะธัั
3. **ะะพะปะณะพััะพัะฝะพ:** ะฃะฑัะฐัั `@Tree('closure-table')` ะดะตะบะพัะฐัะพั ะธ ะผะธะณัะฐัะธั ะดะปั ัะดะฐะปะตะฝะธั `activities_closure`, ะตัะปะธ ะฝะต ะธัะฟะพะปัะทัะตััั 6+ ะผะตัััะตะฒ

### ะัะพะฑะปะตะผะฐ 3: ActivityMember โ ะฟะพะปะฝะพัััั "ัะฟััะฐั" entity

**ะกััั:** ActivityMember โ ะพะดะฝะฐ ะธะท ัััั edge-entity ะฒ ะณัะฐัะต, ะฝะพ ะตะดะธะฝััะฒะตะฝะฝะฐั, ะบะพัะพัะฐั ะฝะต ัะฐะฑะพัะฐะตั. Extraction pipeline ัะพััะฐะฝัะตั ััะฐััะฝะธะบะพะฒ ะฟัะพะตะบัะพะฒ ะบะฐะบ ัััะพะบะพะฒัะน ะผะฐััะธะฒ ะฒ `Activity.metadata.participants`, ะผะธะฝัั ััััะบัััะธัะพะฒะฐะฝะฝัั ActivityMember.

**ะะพัะปะตะดััะฒะธั:**
- ะะตะฒะพะทะผะพะถะฝะพ ะฝะฐะนัะธ "ะฒัะต ะฟัะพะตะบัั, ะฒ ะบะพัะพััั ััะฐััะฒัะตั ะะฒะฐะฝะพะฒ" ัะตัะตะท SQL JOIN
- ะะตั ัะพะปะตะฒะพะน ะผะพะดะตะปะธ: ะฝะตะฟะพะฝััะฝะพ ะบัะพ owner, ะธัะฟะพะปะฝะธัะตะปั, ะฝะฐะฑะปัะดะฐัะตะปั
- `metadata.participants` โ ะฝะตัะตะทะพะปะฒะปะตะฝะฝัะต ัััะพะบะธ, ะฝะต ะฟัะธะฒัะทะฐะฝะฝัะต ะบ Entity

**ะะปะฐะฝ ััััะฐะฝะตะฝะธั (ะัะพะฑะปะตะผะฐ 8 ะฒ ะฟะปะฐะฝะต ัะปัััะตะฝะธะน):**
1. ะกะพะทะดะฐัั `ActivityMemberService` ั ะผะตัะพะดะพะผ `resolveAndCreateMembers()`
2. ะะฝัะตะณัะธัะพะฒะฐัั ะฒ `extraction-persistence.service.ts` โ ะฟัะธ ัะพะทะดะฐะฝะธะธ Activity ัะพะทะดะฐะฒะฐัั ActivityMember ะทะฐะฟะธัะธ
3. ะะธะณัะธัะพะฒะฐัั ัััะตััะฒัััะธะต `metadata.participants` โ ActivityMember
4. ะัะตะบัะฐัะธัั ะธัะฟะพะปัะทะพะฒะฐะฝะธะต `metadata.participants` ะดะปั ััะฐััะฝะธะบะพะฒ

### ะัะพะฑะปะตะผะฐ 4: ะะพัะตัั ะดะฐะฝะฝัั ะฟัะธ extraction

**ะกััั:** Extraction pipeline ะธะทะฒะปะตะบะฐะตั ะธะฝัะพัะผะฐัะธั, ะฝะพ ัะฐััั ะดะฐะฝะฝัั ัะตััะตััั ะฟัะธ ะฟะตััะธััะตะฝัะธะธ:

| ะงัะพ ะธะทะฒะปะตะบะฐะตััั | ะงัะพ ัะพััะฐะฝัะตััั | ะงัะพ ัะตััะตััั |
|-----------------|-----------------|--------------|
| InferredRelations (LLM) | โ | ะัั (ะบะพะด ัะพััะฐะฝะตะฝะธั ะฝะต ะฝะฐะฟะธัะฐะฝ) |
| Commitment ั ะบะพะฝัะตะบััะพะผ ะฟัะพะตะบัะฐ | Commitment ะฑะตะท activityId | ะัะธะฒัะทะบะฐ ะบ ะฟัะพะตะบัั |
| Activity ั ััะฐััะฝะธะบะฐะผะธ | Activity + metadata.participants | ะกัััะบัััะธัะพะฒะฐะฝะฝัะต ัะพะปะธ |
| Project description ะธะท ะพะฑััะถะดะตะฝะธั | โ | description (ะฟะพะปะต NULL) |

**ะะปะฐะฝ ััััะฐะฝะตะฝะธั (ะัะพะฑะปะตะผะฐ 8 ะฒ ะฟะปะฐะฝะต ัะปัััะตะฝะธะน):**
1. **InferredRelations:** ะะพะฑะฐะฒะธัั `persistInferredRelations()` ะฒ extraction-persistence, ัะพะทะดะฐะฒะฐัั draft EntityRelation + EntityRelationMember
2. **Commitment.activityId:** ะะฑะพะณะฐัะธัั extraction prompt, ะดะพะฑะฐะฒะธัั ะปะธะฝะบะพะฒะบั ะฟะพ ะธะผะตะฝะธ ะฟัะพะตะบัะฐ
3. **Activity ะฟะพะปั:** ะะฐััะธัะธัั ExtractedProject ัะธะฟ, ะผะฐะฟะฟะธัั description/priority/deadline/tags ะธะท extraction

### ะะฑัะธะน roadmap ััััะฐะฝะตะฝะธั

| ะัะธะพัะธัะตั | ะงัะพ | ะะพะณะดะฐ | ะกััะปะบะฐ |
|-----------|-----|-------|--------|
| ๐ด P0 | ActivityMember wiring | Phase 3 (Week 4) ะฟะปะฐะฝะฐ | ะัะพะฑะปะตะผะฐ 8.1 |
| ๐ด P0 | InferredRelations persistence | Phase 3 (Week 4) ะฟะปะฐะฝะฐ | ะัะพะฑะปะตะผะฐ 8.3 |
| ๐ก P1 | Commitment โ Activity linking | Phase 3 (Week 4) ะฟะปะฐะฝะฐ | ะัะพะฑะปะตะผะฐ 8.2 |
| ๐ก P1 | Activity fields enrichment | Phase 3 (Week 4) ะฟะปะฐะฝะฐ | ะัะพะฑะปะตะผะฐ 8.4 |
| ๐ข P2 | ะฃะฑัะฐัั ะธะทะฑััะพัะฝัะต tree patterns | ะะพัะปะต Phase 7 | ะัะพะฑะปะตะผะฐ 2 |
| ๐ข P2 | ะะฑะฝะพะฒะปััั ััะพั ะดะพะบัะผะตะฝั ะฟัะธ ะบะฐะถะดะพะผ ะธะทะผะตะฝะตะฝะธะธ | Ongoing | ะัะพะฑะปะตะผะฐ 1 |

---

## ะะธะทัะฐะปัะฝัะต ััะตะผั

### ะะพะปะฝะฐั ััะตะผะฐ ะณัะฐัะฐ

```
                                 โโโโโโโโโโโโโโโโโโโโโโโ
                                 โ      ACTIVITY       โ
                                 โ  (PROJECT/TASK/..)  โ
                                 โโโโโโโโโโโโฌโโโโโโโโโโโ
                                            โ
              โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
              โ ActivityMember              โ ownerEntityId               โ Commitment
              โ (role: assignee,member..)   โ clientEntityId              โ (activityId)
              โผ                             โผ                             โผ
    โโโโโโโโโโโโโโโโโโโ           โโโโโโโโโโโโโโโโโโโ           โโโโโโโโโโโโโโโโโโโ
    โ     ENTITY      โโโโโโโโโโโโโ     ENTITY      โโโโโโโโโโโโบโ     ENTITY      โ
    โ    (Person)     โ           โ    (Person)     โ           โ    (Person)     โ
    โโโโโโโโโโฌโโโโโโโโโ           โโโโโโโโโโฌโโโโโโโโโ           โโโโโโโโโโฌโโโโโโโโโ
             โ                             โ                             โ
             โ EntityRelation              โ Commitment                  โ EntityFact
             โ (MARRIAGE/FRIEND..)         โ (PROMISE/REQUEST)           โ (BIRTHDAY/..)
             โ                             โ                             โ
             โผ                             โผ                             โผ
    โโโโโโโโโโโโโโโโโโโ           โโโโโโโโโโโโโโโโโโโ           โโโโโโโโโโโโโโโโโโโ
    โ     ENTITY      โ           โ     ENTITY      โ           โ  (ะฐััะธะฑััั)     โ
    โ    (Person)     โ           โ    (Person)     โ           โ                 โ
    โโโโโโโโโโโโโโโโโโโ           โโโโโโโโโโโโโโโโโโโ           โโโโโโโโโโโโโโโโโโโ
             โ
             โ EntityRelation (EMPLOYMENT)
             โผ
    โโโโโโโโโโโโโโโโโโโ
    โ     ENTITY      โ
    โ  (Organization) โ
    โโโโโโโโโโโโโโโโโโโ
```

### ะะตัะฐััะธั ะดะฐะฝะฝัั

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                              DATA FLOW                                       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

    Telegram/Phone/Meet                    Mini App / Telegram Bot
           โ                                        โฒ
           โผ                                        โ
    โโโโโโโโโโโโโโโ                         โโโโโโโโดโโโโโโโ
    โ  Interaction โ                         โ Dashboard   โ
    โ  + Messages  โ                         โ Recall      โ
    โ  + Segments  โ                         โ Prepare     โ
    โโโโโโโโฌโโโโโโโ                         โโโโโโโโฌโโโโโโโ
           โ                                        โ
           โ Extraction                             โ Query
           โผ                                        โ
    โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    โ                        KNOWLEDGE GRAPH                               โ
    โ  โโโโโโโโโโโโ  โโโโโโโโโโโโ  โโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโโโโโโ โ
    โ  โ  Entity  โโโโ Relation โโโโ  Entity  โโโโ EntityFact           โ โ
    โ  โโโโโโฌโโโโโโ  โโโโโโโโโโโโ  โโโโโโฌโโโโโโ  โ EntityRelation       โ โ
    โ       โ                           โ        โ Commitment           โ โ
    โ       โ    โโโโโโโโโโโโโโโโโโโโโโโโ        โ Activity             โ โ
    โ       โ    โ                               โ ActivityMember       โ โ
    โ       โผ    โผ                               โ InteractionSummary   โ โ
    โ  โโโโโโโโโโโโโโโโ                          โ RelationshipProfile  โ โ
    โ  โ   Activity   โ                          โโโโโโโโโโโโโโโโโโโโโโโโ โ
    โ  โ  (PROJECT)   โ                                                   โ
    โ  โโโโโโโโโโโโโโโโ                                                   โ
    โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ะกะฒะพะดะฝะฐั ัะฐะฑะปะธัะฐ

| ะกััะฝะพััั | ะขะธะฟ | ะกัะฐััั | ะคะฐะนะป | ะกััะพะบะฐ |
|----------|-----|--------|------|--------|
| **ะฃะทะปั** | | | | |
| Entity | Node | ๐ข PRODUCTION | `packages/entities/src/entity.entity.ts` | 31 |
| Activity | Node | ๐ก PARTIAL | `packages/entities/src/activity.entity.ts` | 115 |
| **ะััะธะฑััั** | | | | |
| EntityFact | Node Property | ๐ข PRODUCTION | `packages/entities/src/entity-fact.entity.ts` | 80 |
| EntityIdentifier | Node Property | ๐ข PRODUCTION | `packages/entities/src/entity-identifier.entity.ts` | โ |
| **ะัะฑัะฐ** | | | | |
| EntityRelation | Edge (N-ary) | ๐ก PARTIAL | `packages/entities/src/entity-relation.entity.ts` | 26 |
| EntityRelationMember | Edge (N-ary) | ๐ก PARTIAL | `packages/entities/src/entity-relation-member.entity.ts` | โ |
| RelationType | Enum | ๐ข PRODUCTION | `packages/entities/src/relation-type.enum.ts` | 5 |
| Commitment | Edge | ๐ก PARTIAL | `packages/entities/src/commitment.entity.ts` | 92 |
| ActivityMember | Edge | ๐ด DORMANT | `packages/entities/src/activity-member.entity.ts` | 49 |
| **ะะณัะตะณะฐัะธะธ** | | | | |
| EntityRelationshipProfile | Summary | ๐ข PRODUCTION | `packages/entities/src/entity-relationship-profile.entity.ts` | 48 |
| InteractionSummary | Summary | ๐ข PRODUCTION | `packages/entities/src/interaction-summary.entity.ts` | 38 |
| **ะััะพัะฝะธะบะธ** | | | | |
| Interaction | Raw Data | ๐ข PRODUCTION | `packages/entities/src/interaction.entity.ts` | 39 |
| Message | Raw Data | ๐ข PRODUCTION | `packages/entities/src/message.entity.ts` | โ |
| TranscriptSegment | Raw Data | ๐ข PRODUCTION | `packages/entities/src/transcript-segment.entity.ts` | โ |
| InteractionParticipant | Raw Data | ๐ข PRODUCTION | `packages/entities/src/interaction-participant.entity.ts` | โ |
| **ะะปะฐะฝะธััะตะผัะต (Phase E)** | | | | |
| TopicalSegment | Planned | โช PLANNED | `docs/second-brain/06-PHASE-E-KNOWLEDGE-PACKING.md` | โ |
| KnowledgePack | Planned | โช PLANNED | `docs/second-brain/06-PHASE-E-KNOWLEDGE-PACKING.md` | โ |

---

## ะกะผ. ัะฐะบะถะต

- [DATA_MODEL.md](./DATA_MODEL.md) โ ะผะพะดะตะปั ะดะฐะฝะฝัั, ER-ะดะธะฐะณัะฐะผะผะฐ
- [ARCHITECTURE.md](./ARCHITECTURE.md) โ ะฐััะธัะตะบัััะฐ ัะธััะตะผั
- [second-brain/INDEX.md](./second-brain/INDEX.md) โ roadmap ัะฐะทะฒะธัะธั
- [second-brain/06-PHASE-E-KNOWLEDGE-PACKING.md](./second-brain/06-PHASE-E-KNOWLEDGE-PACKING.md) โ Phase E ัะฟะตัะธัะธะบะฐัะธั
