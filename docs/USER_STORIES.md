# User Stories

## MVP

### Telegram Integration

| ID | Story | Acceptance Criteria | Priority |
|----|-------|---------------------|----------|
| US-1 | Как пользователь, я хочу чтобы все мои Telegram сообщения автоматически сохранялись | Входящие и исходящие сообщения из личных чатов сохраняются в БД в реальном времени | P0 |
| US-2 | Как пользователь, я хочу чтобы голосовые сообщения расшифровывались | Голосовые сообщения транскрибируются и текст доступен для поиска | P0 |
| US-3 | Как пользователь, я хочу видеть сообщения сгруппированными по сессиям | Сообщения с gap > 4 часов разделены на разные сессии (interactions) | P1 |

### Phone Calls

| ID | Story | Acceptance Criteria | Priority |
|----|-------|---------------------|----------|
| US-4 | Как пользователь, я хочу загружать записи телефонных разговоров | Интерфейс для upload аудиофайла с указанием номера телефона и даты | P0 |
| US-5 | Как пользователь, я хочу чтобы разговоры автоматически расшифровывались | После загрузки запускается асинхронная транскрипция с разделением говорящих | P0 |
| US-6 | Как пользователь, я хочу видеть статус обработки | Отображается статус: pending → processing → ready/error | P1 |
| US-7 | Как пользователь, я хочу видеть транскрипт с разделением по говорящим | Транскрипт показывает кто что сказал с таймкодами | P0 |

### Entity Management

| ID | Story | Acceptance Criteria | Priority |
|----|-------|---------------------|----------|
| US-8 | Как пользователь, я хочу видеть список всех контактов | Отображается список entities с возможностью фильтрации и поиска | P0 |
| US-9 | Как пользователь, я хочу создавать контакты вручную | Форма создания entity с типом (person/org), именем, организацией | P1 |
| US-10 | Как пользователь, я хочу редактировать информацию о контакте | Редактирование имени, организации, заметок | P1 |
| US-11 | Как пользователь, я хочу объединять дубликаты контактов | Функция merge двух entities с переносом всех связей | P2 |

### Entity Resolution

| ID | Story | Acceptance Criteria | Priority |
|----|-------|---------------------|----------|
| US-12 | Как пользователь, я хочу видеть список неопознанных контактов | Отображается список pending_entity_resolutions с примерами сообщений | P0 |
| US-13 | Как пользователь, я хочу связать неопознанный контакт с существующим | Выбор из списка существующих entities или создание нового | P0 |
| US-14 | Как пользователь, я хочу видеть предложения системы | Отображаются suggestions от Worker с confidence и обоснованием | P1 |

### Context Retrieval

| ID | Story | Acceptance Criteria | Priority |
|----|-------|---------------------|----------|
| US-15 | Как пользователь, я хочу получить контекст по человеку | Запрос по имени или ID возвращает структурированную сводку | P0 |
| US-16 | Как пользователь, я хочу уточнить контекст задачей | Параметр task_hint фокусирует выдачу на релевантной информации | P1 |
| US-17 | Как пользователь, я хочу получить контекст по организации | Запрос по организации агрегирует информацию по всем связанным людям | P2 |

### Search

| ID | Story | Acceptance Criteria | Priority |
|----|-------|---------------------|----------|
| US-18 | Как пользователь, я хочу искать по тексту сообщений | Full-text поиск с подсветкой результатов | P0 |
| US-19 | Как пользователь, я хочу семантический поиск | Поиск находит связанные по смыслу сообщения | P1 |
| US-20 | Как пользователь, я хочу фильтровать результаты | Фильтры: entity, период, тип взаимодействия | P1 |

### Facts Management

| ID | Story | Acceptance Criteria | Priority |
|----|-------|---------------------|----------|
| US-21 | Как пользователь, я хочу добавлять факты о контактах вручную | Форма добавления факта с типом, значением, периодом актуальности | P1 |
| US-22 | Как пользователь, я хочу видеть историю изменений фактов | Отображается история должностей, контактов с датами | P2 |
| US-23 | Как пользователь, я хочу подтверждать извлечённые факты | Pending facts отображаются для review с кнопками approve/reject | P1 |

### Automation

| ID | Story | Acceptance Criteria | Priority |
|----|-------|---------------------|----------|
| US-24 | Как пользователь, я хочу чтобы звонки автоматически анализировались | После транскрипции Claude определяет speakers, извлекает факты | P1 |
| US-25 | Как пользователь, я хочу получать suggestions для entity resolution | Ежедневно система анализирует pending resolutions и предлагает matches | P1 |
| US-26 | Как пользователь, я хочу получать еженедельный дайджест | В понедельник приходит сводка: статистика, дни рождения, ключевые разговоры | P2 |

---

## Post-MVP

### Video Meetings

| ID | Story | Priority |
|----|-------|----------|
| US-30 | Загрузка записей Google Meet | P1 |
| US-31 | Автоматический импорт из Google Meet | P2 |
| US-32 | Отображение участников встречи | P1 |

### Advanced Automation

| ID | Story | Priority |
|----|-------|----------|
| US-33 | Автоматическое извлечение фактов из переписки | P1 |
| US-34 | Automatic summarization старых разговоров | P2 |
| US-35 | Напоминания о днях рождения | P2 |

### Integrations

| ID | Story | Priority |
|----|-------|----------|
| US-36 | Интеграция с Google Calendar | P2 |
| US-37 | Экспорт контактов CSV/VCF | P3 |
| US-38 | Импорт контактов | P3 |

### Mobile

| ID | Story | Priority |
|----|-------|----------|
| US-40 | Мобильное приложение | P2 |
| US-41 | Push-уведомления | P3 |
| US-42 | Quick actions перед звонком | P3 |

---

## Acceptance Criteria Details

### US-1: Автосохранение Telegram сообщений

**Given:** Telegram Adapter подключен и авторизован
**When:** Пользователь получает или отправляет сообщение в личном чате
**Then:**
- Сообщение сохраняется в БД в течение 5 секунд
- Сохраняются: текст, время, отправитель, chat_id, message_id
- Если media — сохраняется тип и ссылка на файл

### US-5: Транскрипция телефонных разговоров

**Given:** Пользователь загрузил аудиофайл звонка
**When:** Файл принят системой
**Then:**
- Создаётся Interaction с status='processing'
- Запускается Job транскрипции
- После завершения: создаются сегменты, status обновляется
- Время обработки: < 2 минут для 10-минутного звонка

### US-15: Получение контекста

**Given:** Существует Entity с историей взаимодействий
**When:** Пользователь запрашивает контекст по имени или ID
**Then:**
- Возвращается Markdown документ с: info, facts, status, interactions
- Размер контекста: 500-2000 токенов
- Время генерации: < 10 секунд

### US-24: Автоматический анализ звонков

**Given:** Транскрипция звонка завершена
**When:** Worker обрабатывает звонок
**Then:**
- Определяется кто "self" и кто "other"
- Извлекается имя собеседника если представился
- Предлагается match с существующим entity
- Извлекаются факты и action items
- Генерируется summary
